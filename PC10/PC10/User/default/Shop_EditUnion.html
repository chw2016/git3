<include file="Public:head"/> 
<link rel="stylesheet" type="text/css" href="{weikucms::RES}/css/cymain.css" />
<script src="/tpl/static/artDialog/jquery.artDialog.js?skin=default"></script>
<script src="/tpl/static/artDialog/plugins/iframeTools.js"></script>
 <link rel="stylesheet" href="{weikucms::STATICS}/kindeditor/themes/default/default.css" />
<link rel="stylesheet" href="{weikucms::STATICS}/kindeditor/plugins/code/prettify.css" />
<script src="{weikucms::STATICS}/kindeditor/kindeditor.js" type="text/javascript"></script>
<script src="{weikucms::STATICS}/kindeditor/lang/zh_CN.js" type="text/javascript"></script>
<script src="{weikucms::STATICS}/kindeditor/plugins/code/prettify.js" type="text/javascript"></script>
<script type="text/javascript" src="{weikucms::RES}/js/formCheck/formcheck.js"> </script>

	<div class="cLineB">
		<h4 class="left">修改社区</h4>

		<div class="searchbar">
<script>
function setlatlng(longitude,latitude){
	art.dialog.data('long', longitude);
	art.dialog.data('lat', latitude);
	art.dialog.open('{weikucms::U('Map/setLatLng',array('token'=>$token,'id'=>$id))}',{lock:false,title:'设置经纬度',width:874,height:700,yesText:'关闭',background: '#000',opacity: 0.87});
}
</script>
<script>
    KindEditor.ready(function(K){
        var editor = K.editor({
            allowFileManager:true
        });
        K('#upload').click(function() {
            editor.loadPlugin('image', function() {
                editor.plugin.imageDialog({
                    fileUrl : K('#pic').val(),
                    clickFn : function(url, title) {
                        K('#pic').val(url);
                        $("#image_show").attr('src',url).show();
                        editor.hideDialog();
                    }
                });
            });
        });
    });


</script>
</div>
<div class="clr"></div>
</div>

<!--tab start-->
	<div class="alert alert-info">
		<button type="button" class="close" data-dismiss="alert">×</button>
		<strong>提示信息!</strong>
		<ol>
			<li>在这里可以了解微门店今日的订单数、订单总数、会员总数，还可以添加分店、编辑分店、删除分店，最后还可以根据分店名称进入后台管理。</li>
		</ol>
	</div>
<!--tab end-->
	<div class="msgWrap">
 		<form class="form" method="post" id="form" action="">
    		<div class="msgWrap bgfc"> 
     			<table class="userinfoArea" style=" margin:0;" border="0" cellspacing="0" cellpadding="0" width="100%"> 
      			<tbody> 
			       <tr> 
				        <th>社区名称：</th>
				        
				        <td>
				        	<input type="text" id="cname" name="cname" value="{weikucms:$data.cname}" class="px require" style="width:300px;" />
                            <input type="hidden" id="id" name="id" value="{weikucms:$data.id}"/>
				        </td>
			       </tr>

                   <tr>
                       <th>社区电话：</th>

                       <td>
                           <input type="text" id="tel" name="tel" value="{weikucms:$data.tel}" class="px require" style="width:300px;" />
                       </td>
                   </tr>

                   <tr>
                       <th> 归属地：</th>

                       <td>
                           <div style="margin-bottom:10px;">
                               <select id="s_province" name="s_province" style="width: 315px;"></select>
                               <br/>
                               <select id="s_city" name="s_city" style="width: 315px;"></select>
                               <br/>
                               <select id="s_county" name="s_county" style="width: 315px;"></select>
                               <script class="resources library" src="tpl/Wap/default/common/forward/js/area.js" type="text/javascript"></script>
                               <script type="text/javascript">_init_area();</script>
                           </div>
                       </td>
                   </tr>

                   <tr>
                       <th>地址：</th>

                       <td>
                           <input type="text" id="address" name="address" value="{weikucms:$data.address}" class="px require" style="width:300px;" />
                       </td>
                   </tr>

                   <tr>
                       <th>归属区域：</th>
                       <td>
                           <select name="mid" id="mid" style="width: 315px;">
                               <option value="0">请选择店铺区域</option>
                               <volist name="member" id="member">
                                   <<option value="{weikucms:$member.id}" <if condition="$data[mid] eq $member[id]">selected=""</if>>{weikucms:$member.username}</option>
                               </volist>
                           </select>
                   </tr>


                   <tr>
				       <TR>
				           <TH valign="top">社区图片：</TH>
				           <TD>
                               <input type="text" class="px" id="pic" name="pic"  value="{weikucms:$data.pic}" style="width: 400px;" readonly/>
                               <span class="ke-button-common" id="upload">上传图片</span>
				           </TD>
				       </TR>
			</tr>
	        <tr> 
		        <th>社区地址的经纬度：</th>
		        <td>
		        	经度 <input type="text" id="longitude" style="width:80px;" name="longitude" size="14" class="px" value="{weikucms:$data.long}" />
		        	纬度 <input type="text"  name="latitude" style="width:80px;" size="14" id="latitude" class="px" value="{weikucms:$data.lat}" /> <a href="###" onclick="setlatlng($('#longitude').val(),$('#latitude').val())">在地图中查看/设置</a>
		        </td> 
	       </tr>
	       
	       <tr> 
		        <th>社区描述信息：</th>
		        <td>
		        	<textarea name="des" id="des" value="" rows="4" style="width:500px;height:120px">{weikucms:$data.des}</textarea>
				</td>
		  </tr>
                   <tr>
                       <th>社区公告：</th>
                       <td>
                           <textarea name="notice" id="notice" rows="4" style="width:500px;height:120px">{weikucms:$data.notice}</textarea>
                       </td>
                   </tr>
       		<tr>
       			<th>&nbsp;</th>
		       <td>
       			<button type="button" id="bsubmit" name="button" class="btn btn-primary">修改社区</td>
       		</tr>
      	</tbody> 
     	</table> 
 	</div>
 </form> 
</div>
<div class="cLine">

<div class="clr"></div>
</div>
</div>
<script type="text/javascript">
    $(function(){
        $("#bsubmit").click(function(){
            var cname = $("#cname").val();
            var pic = $("#pic").val();
            var long = $("#longitude").val();
            var lat = $("#latitude").val();
            var des = $("#des").val();
            var id=$("#id").val();
            var notice=$("#notice").val();
            var tel=$("#tel").val();
            var mid=$("#mid").val();
            var address=$("#address").val();
            var seng=$("#s_province").val().trim();
            var si=$("#s_city").val().trim();
            var xian=$("#s_county").val().trim();
            if(xian=="市、县级市"){
                notif({
                    msg: "归属地不正确",
                    type: "warning"
                });
                return false;
            }
            if(!cname){
                notif({
                    msg: "社区名称不能为空",
                    type: "warning"
                });
                return false;
            }



            if(mid==0){
                notif({
                    msg: "请选择区域",
                    type: "warning"
                });
                return false;
            }

            if(! pic){
                notif({
                    msg: "图片不能为空",
                    type: "warning"
                });
                return false;
            }



            if(! long || !lat){
                notif({
                    msg: "经纬度不能为空",
                    type: "warning"
                });
                return false;
            }

            if(! des){
                notif({
                    msg: "社区描述不能为空",
                    type: "warning"
                });
                return false;
            }
            $.post("{weikucms::U('Shop/EditUnion',array('token'=>$token))}",{id:id,address:address,cname:cname,pic:pic,long:long,lat:lat,des:des,tel:tel,notice:notice,mid:mid},function(data){
                    if(data.status==1){
                        notif({
                            msg: data.info,
                            type: "success"
                        });
                        location.href="{weikucms::U('Shop/Union',array('token'=>$token))}";
                    }else{
                        notif({
                            msg: data.info,
                            type: "warning"
                        });
                    }
            },"json")
        });
    });

</script>
<include file="Public:footer"/>