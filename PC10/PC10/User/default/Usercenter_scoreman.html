<include file="Public:head"/>
<script src="{weikucms::RES}/js/card/jquery.js"  type="text/javascript" ></script>



    <div class="cLineB">
        <div class="title_tab" id="topTab">
            <ul class="tab_navs title_tab" data-index="0">

                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenter/index',array('token'=>$token))}" <if condition="$hover eq 1" >class="hover"</if>>用户中心设置</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenter/memberman',array('token'=>$token))}" <if condition="$hover eq 2" >class="hover"</if>>微信会员管理</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenter/salecard',array('token'=>$token))}" <if condition="$hover eq 3" >class="hover"</if>>会员优惠</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenter/scoreman',array('token'=>$token))}" <if condition="$hover eq 4" >class="hover"</if>>积分规则</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenter/userlevel',array('token'=>$token))}" <if condition="$hover eq 6" >class="hover"</if>>会员等级</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenter/notice',array('token'=>$token))}" <if condition="$hover eq 7" >class="hover"</if>>会员通知</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenter/shitimember',array('token'=>$token))}" <if condition="$hover eq 5" >class="hover"</if>>实体会员</a>
                </li>
				                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Integralshop/index',array('token'=>$token))}" <if condition="$hover eq 5" >class="hover"</if>>积分商城</a>
                </li>
            </ul>
        </div>
    </div>


    <div class="alert alert-info">
        <button type="button" class="close" data-dismiss="alert">×</button>
        <strong>提示信息!</strong>
        <ol>
            <li>通过设置关联活动模块，让积分更灵活</li>

        </ol>
    </div>

    <div class="msgWrap">

        <div class="box-content">
            <div class="tab-pane fade active in" id="home">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>应用名称</th>
                        <th>需要会员</th>
                        <th>需要积分</th>
                        <th style="width: 360px;">操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <volist name="applist" id="vo">
                        <tr>
                            <td>{weikucms:$vo.app_name}</td>

                            <td>
                                <if condition="$vo['is_member'] eq 1">
                                    <span class="badge badge-success">是</span>
                                    <elseif condition="$vo['is_member'] eq 0" />
                                    <span class="badge badge-info">否</span>
                                    <else/>
                                    <span class="badge badge-info">未设置</span>
                                </if>
                                </td>
                            <td>
                                <if condition="$vo['is_score'] eq 1">
                                    <span class="badge badge-success">是</span>
                                    <elseif condition="$vo['is_member'] eq 0" />
                                    <span class="badge badge-info">否</span>
                                    <else/>
                                    <span class="badge badge-info">未设置</span>
                                </if>
                            </td>
                            <td>
                                <a href="{weikucms::U('Usercenter/setscore',array('token'=>$token,'app_id'=>$vo['id']))}" class="btn btn-success">设置</a>
                            </td>
                        </tr>
                    </volist>
                    </tbody>
                </table>

            </div>
            <div>
                <ul class="pager">
                    {weikucms:$page}
                </ul>
            </div>


        </div>





    </div>

    <div class="alert alert-info">
        <button type="button" class="close" data-dismiss="alert">×</button>
        <strong>提示信息!</strong>
        <ol>
            <li>签到模块积分设置</li>

        </ol>
    </div>

    <div class="msgWrap">

        <div class="box-content">
            <div class="tab-pane fade active in">
                <form action="" method="post" class="form-horizontal form-validate" novalidate="novalidate">
                    <input type="hidden" name="id" id="id" value="{weikucms:$signdata.id}">
                    <div class="control-group">
                        <label class="control-label">每日签到领取积分：</label>
                        <div class="controls">
                            <input type="text" name="day_score" id="day_score" value="{weikucms:$signdata.day_score}" class="input-small" data-rule-required="true">
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">连续签到：</label>
                        <div class="controls">
                            <input type="text" name="days" id="days" value="{weikucms:$signdata.days}" class="input-small" data-rule-required="true">
                            天奖励
                            <input type="text" name="scores" id="scores" value="{weikucms:$signdata.scores}" class="input-small" data-rule-required="true">
                            积分
                        </div>

                    </div>

                    <div class="control-group">
                        <label for="title" class="control-label">是否开启签到：</label>
                        <div class="controls">
                            <select name="status" id="status">
                                <option value="2"  <if condition="$signdata['status'] eq 2">selected</if>>关闭</option>
                                <option value="1"  <if condition="$signdata['status'] eq 1">selected</if>>开启</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button id="bsubmit" type="button" data-loading-text="提交中..." class="btn btn-primary">保存</button>

                    </div>
                </form>
                </div>
            </div>
        </div>


    <div class="alert alert-info">
        <button type="button" class="close" data-dismiss="alert">×</button>
        <strong>提示信息!</strong>
        <ol>
            <li>会员积分使用规则</li>

        </ol>
    </div>

    <div class="box-content">
        <div class="tab-pane fade active in">
            <form action="" method="post" class="form-horizontal form-validate" novalidate="novalidate">
                <input type="hidden" name="id" id="id" value="{weikucms:$signdata.id}">


                <div class="control-group">
                    <label for="title" class="control-label">会员积分使用规则：</label>
                    <div class="controls">
                        <textarea id="member_score_guize">{weikucms:$usercenter_set.member_score_guize}</textarea>
                    </div>
                </div>

                <div class="form-actions">
                    <button id="csubmit" type="button" data-loading-text="提交中..." class="btn btn-primary">保存</button>

                </div>
            </form>
        </div>
    </div>
    </div>

    <include file="Public:footer"/>


    <script type="text/javascript">
        $(function(){
            $("#bsubmit").click(function(){
                var day_score = $("#day_score").val();
                var id = $("#id").val();
                var days = $("#days").val();
                var scores = $("#scores").val();
                var status = $("#status").val();
                var __hash__ =  $("input[name='__hash__']").val();
                var re = /^[1-9]+[0-9]*]*$/;
                if(!re.test(day_score)){
                    notif({
                        msg: "请输入正确的每日签到积分数",
                        type: "warning"
                    });
                    return false;
                }

                if(!re.test(days) || !re.test(scores)){
                    notif({
                        msg: "请正确输入连续签到积分奖励",
                        type: "warning"
                    });
                    return false;
                }
                if(!id){
                    id = 0;
                }

                $.post("{weikucms::U('Usercenter/signset',array('token'=>$token))}",
                        {id:id,day_score:day_score,days:days,scores:scores,status:status,__hash__:__hash__},
                        function(data){
                            if(data.status == 1){
                                notif({
                                    msg: data.info,
                                    type: "success"
                                });
                                setTimeout(function(){
                                    window.location.reload();
                                },'1000');
                            }else{
                                notif({
                                    msg: data.info,
                                    type: "error"
                                });
                            }
                        },'json');

            });

            $("#csubmit").click(function(){
                var member_score_guize = $("#member_score_guize").val();
                var __hash__ =  $("input[name='__hash__']").val();
                if(!member_score_guize){
                    notif({
                        msg: "会员积分规则不能为空",
                        type: "warning"
                    });
                    return false;
                }

                $.post("{weikucms::U('Usercenter/update_member_score_guize',array('token'=>$token))}",
                        {member_score_guize:member_score_guize,__hash__:__hash__},
                        function(data){
                            if(data.status == 1){
                                notif({
                                    msg: data.info,
                                    type: "success"
                                });
                                setTimeout(function(){
                                    window.location.reload();
                                },'1000');
                            }else{
                                notif({
                                    msg: data.info,
                                    type: "error"
                                });
                            }
                        },'json');

            });
        });

    </script>


</div>