<include file="Public:head"/> 
<link rel="stylesheet" type="text/css" href="{weikucms::RES}/css/cymain.css" />
<script src="/tpl/static/artDialog/jquery.artDialog.js?skin=default"></script>
<script src="/tpl/static/artDialog/plugins/iframeTools.js"></script>
 <link rel="stylesheet" href="{weikucms::STATICS}/kindeditor/themes/default/default.css" />
<link rel="stylesheet" href="{weikucms::STATICS}/kindeditor/plugins/code/prettify.css" />
<script src="{weikucms::STATICS}/kindeditor/kindeditor.js" type="text/javascript"></script>
<script src="{weikucms::STATICS}/kindeditor/lang/zh_CN.js" type="text/javascript"></script>
<script src="{weikucms::STATICS}/kindeditor/plugins/code/prettify.js" type="text/javascript"></script>
<script type="text/javascript" src="{weikucms::RES}/js/formCheck/formcheck.js"> </script>
<script type="text/javascript" src="http://cdn.bootcss.com/select2/3.3.2/select2.js"> </script>
<link rel="stylesheet" href="http://cdn.bootcss.com/select2/3.3.2/select2.css" />
	<div class="cLineB">
		<h4 class="left">修改店铺</h4>

		<div class="searchbar">
<script>
function setlatlng(longitude,latitude){
	art.dialog.data('long', longitude);
	art.dialog.data('lat', latitude);
	art.dialog.open('{weikucms::U('Map/setLatLng',array('token'=>$token,'id'=>$id))}',{lock:false,title:'设置经纬度',width:874,height:700,yesText:'关闭',background: '#000',opacity: 0.87});
}
</script>
<script>
    KindEditor.ready(function(K){
        var editor = K.editor({
            allowFileManager:true
        });
        K('#upload').click(function() {
            editor.loadPlugin('image', function() {
                editor.plugin.imageDialog({
                    fileUrl : K('#pic').val(),
                    clickFn : function(url, title) {
                        K('#pic').val(url);
                        $("#image_show").attr('src',url).show();
                        editor.hideDialog();
                    }
                });
            });
        });
    });


</script>
</div>
<div class="clr"></div>
</div>


	<div class="msgWrap">
 		<form class="form" method="post" id="form" action="">
    		<div class="msgWrap bgfc"> 
     			<table class="userinfoArea" style=" margin:0;" border="0" cellspacing="0" cellpadding="0" width="100%"> 
      			<tbody> 
				    <tr> 
				        <th>店铺微信地址：</th>
				        
				        <td>
				        	<php>echo C('site_url');</php>{weikucms::U('Wap/Commerce/ShopWare',array('token'=>$token,'wareid'=>$data['id']))}
				        </td>
			       </tr>
			       <tr> 
				        <th>店铺名称：</th>
				        
				        <td>
				        	<input type="text" id="uname" name="uname" value="{weikucms:$data.username}" class="px require" style="width:300px;" />
				        </td>
			       </tr>
			       <tr>
				        <th>店铺登录密码：</th>
				        <td>
				        	<input type="password" id="pwd" name="pwd" value="" class="px require" style="width:300px;" />
				        </td>
			       </tr>
			       <tr> 
				        <th>店铺电话：</th>
				        <td>
				        	<input type="text" id="tel" name="tel" value="{weikucms:$data.tel}" class="px require" style="width:300px;" />
				        </td>
			       </tr>


                   <tr>
                       <th>店铺类型：</th>
                       <td>
                           <select name="tid" id="tid" style="width: 315px;">
                               <option value="0">请选择店铺类型</option>
                               <volist name="type" id="type">
                                   <option value="{weikucms:$type.id}" <if condition="$data[tid] eq $type[id]">selected=""</if>>{weikucms:$type.name}</option>
                               </volist>
                           </select>
                   </tr>



                   <tr>
                       <th>所属社区：</th>
                       <td>
                           <select name="uid" id="uid" style="width: 315px;">
                               <option value="0">请选择社区</option>
                               <volist name="union" id="union">
                                   <option value="{weikucms:$union.id}">{weikucms:$union.cname}</option>
                               </volist>
                           </select>
                   </tr>



                   <tr>

                       <th>店铺归属区域：</th>
                       <td>
                           <select name="mid" id="mid" style="width: 315px;">
                               <option value="0">请选择店铺区域</option>
                               <volist name="member" id="member">
                                   <option value="{weikucms:$member.id}" <if condition="$data[mid] eq $member[id]">selected=""</if>>{weikucms:$member.username}</option>
                               </volist>
                           </select>
                   </tr>

                   <tr>
                       <th>店铺街道地址：</th>
                       <td>
                           <input type="text" id="address" name="address" value="{weikucms:$data.address}" class="px require" style="width:300px;" />
                   </tr>

                   <tr>
                       <th>佣金比列：</th>
                       <td>
                           <input type="text" id="rate" name="rate" value="{weikucms:$data.rate}" class="px require" style="width:300px;" />
                   </tr>

                   <tr>
                       <th>门店地图：</th>
                       <td>
                           <input type="text" id="map_url" name="map_url" value="{weikucms:$data.map_url}" class="px require" style="width:300px;" />
                   </tr>

                   <tr>
				       <TR>
				           <TH valign="top">店铺图片：</TH>
				           <TD>
                               <input type="text" class="px" id="pic" name="pic" style="width: 400px;" readonly value="{weikucms:$data[pic]}"/>
                               <span class="ke-button-common" id="upload">上传图片</span>
				           </TD>
				       </TR>
			</tr>
	        <tr> 
		        <th>店铺地址的经纬度：</th>
		        <td>
		        	经度 <input type="text" id="longitude" style="width:80px;" name="longitude" size="14" class="px" value="{weikucms:$data[long]}" />
		        	纬度 <input type="text"  name="latitude" style="width:80px;" size="14" id="latitude" class="px" value="{weikucms:$data[lat]}" /> <a href="###" onclick="setlatlng($('#longitude').val(),$('#latitude').val())">在地图中查看/设置</a>
		        </td> 
	       </tr>
	       
	       <tr> 
		        <th>店铺描述信息：</th>
		        <td>
                    <input type="hidden" value="{weikucms:$data[id]}" id="id"/>
		        	<textarea name="des" id="des" rows="4" style="width:500px;height:120px" value="">{weikucms:$data[des]}</textarea>
				</td>

        <tr> 
            <th>店铺二维码：</th>
            <td>
              <img src="{weikucms:$img}" style="width:200px;height:200px;"> 
        </td>
		  </tr>
       		<tr>
       			<th>&nbsp;</th>
		       <td>
       			<button type="button" id="bsubmit" name="button" class="btn btn-primary">修改分店</td>
       		</tr>
      	</tbody> 
     	</table> 
 	</div>
 </form> 
</div>
<div class="cLine">

<div class="clr"></div>
</div>
</div>
<script type="text/javascript">
    $(function(){
	    $('#uid').select2();
		$('#mid').select2();
        $("#bsubmit").click(function(){
            var id=$("#id").val();
            var uname = $("#uname").val();
            var tel = $("#tel").val();
            var address = $("#address").val();
            var pic = $("#pic").val();
            var long = $("#longitude").val();
            var lat = $("#latitude").val();
            var des = $("#des").val();
            var tid=$("#tid").val();
            var mid=$("#mid").val();
            var rate=$("#rate").val();
            var password=$("#pwd").val();
            var map_url=$("#map_url").val();
            var uid=$("#uid").val();
            if(!uname){
                notif({
                    msg: "店铺名称不能为空",
                    type: "warning"
                });
                return false;
            }


            if(! address){
                notif({
                    msg: "店铺地址不能为空",
                    type: "warning"
                });
                return false;
            }

            if(isNaN(rate)){
                notif({
                    msg: "请填写正确的佣金比列!",
                    type: "warning"
                });
                return false;
            }

            if(mid==0){
                notif({
                    msg: " 请选择店铺区域",
                    type: "warning"
                });
                return false;
            }

            if(tid==0){
                notif({
                    msg: " 请选择店铺类型",
                    type: "warning"
                });
                return false;
            }

            if(! pic){
                notif({
                    msg: "图片不能为空",
                    type: "warning"
                });
                return false;
            }

            if(! long || !lat){
                notif({
                    msg: "经纬度不能为空",
                    type: "warning"
                });
                return false;
            }


            $.post("{weikucms::U('Shop/EditShop',array('token'=>$token))}",{map_url:map_url,id:id,uid:uid,username:uname,password:password,tel:tel,address:address,pic:pic,long:long,lat:lat,des:des,tid:tid,rate:rate,mid:mid},function(data){

                    if(data.status==1){
                        notif({
                            msg: data.info,
                            type: "success"
                        });
                        location.href="{weikucms::U('Shop/index',array('token'=>$token))}";
                    }else{
                        notif({
                            msg: data.info,
                            type: "warning"
                        });
                    }
            },"json")
        });
    });

</script>
<include file="Public:footer"/>