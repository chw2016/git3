<include file="Public:head" />
<link rel="stylesheet" type="text/css" href="{weikucms::RES}/css/cymain.css" />
<script src="/tpl/static/artDialog/jquery.artDialog.js?skin=default"></script>
<script src="/tpl/static/artDialog/plugins/iframeTools.js"></script>
<link rel="stylesheet" href="{weikucms::STATICS}/kindeditor/themes/default/default.css" />
<link rel="stylesheet" href="{weikucms::STATICS}/kindeditor/plugins/code/prettify.css" />
<script src="{weikucms::STATICS}/kindeditor/kindeditor.js" type="text/javascript"></script>
<script src="{weikucms::STATICS}/kindeditor/lang/zh_CN.js" type="text/javascript"></script>
<script src="{weikucms::STATICS}/kindeditor/plugins/code/prettify.js" type="text/javascript"></script>
<script type="text/javascript" src="{weikucms::RES}/js/formCheck/formcheck.js"></script>
<script>
    function setlatlng(longitude,latitude){
        art.dialog.data('longitude', longitude);
        art.dialog.data('latitude', latitude);
        art.dialog.open('{weikucms::U('Map/setLatLng',array('token'=>$token,'id'=>$id))}',{lock:false,title:'设置经纬度',width:800,height:650,yesText:'关闭',background: '#000',opacity: 0.87});
    }
</script>

<div class="" style="<if condition="$brand_id">left:0px<else /></if>">
	<div class="cLineB">
		<h4 class="left">
			<if condition="$op neq 1">添加在线加盟商 <else /> 编辑在线加盟商</if>
		</h4>
		<div class="searchbar"></div>
		<div class="clr"></div>
	</div>
	<!--tab start-->
	<div class="alert alert-info">
		<button type="button" class="close" data-dismiss="alert">×</button>
		<strong>提示信息!</strong>
		<ol>
			<li>在这里可以了解洗衣店在线加盟商的总数、还可以添加在线加盟商、编辑在线加盟商、删除在线加盟商。</li>
		</ol>
	</div>
	<!--tab end-->
	<div class="msgWrap" style="<if condition="$brand_id">margin-left:200px<else /></if>">
		<form class="form" method="post" id="form" action="">
			<input id="brand_id" name="brand_id" value="{weikucms:$a['brand_id']}" type="hidden" />
			<if condition="$op neq 1"> <input id="online_id" name="online_id" value="" type="hidden" /> <else /> <input id="online_id" name="online_id" value="{weikucms:$w['id']}" type="hidden" /> </if>
			<div class="msgWrap bgfc">
				<table class="userinfoArea" style="margin: 0;" border="0" cellspacing="0" cellpadding="0" width="100%">
					<tbody>
						<tr>
							<th>在线加盟商名称：</th>
							<td>
								<if condition="$op neq 1"> <input type="text" id="online_name" name="online_name" value="" class="px require" style="width: 300px; margin-top: 10px" /> <else /> <input type="text" id="online_name" name="online_name" value="{weikucms:$online['online_name']}" class="px require" style="width: 300px;" /> </if>
							</td>
						</tr>

						<tr>
							<th>在线加盟商联系电话：</th>
							<td>
								<if condition="$op neq 1"> <input type="text" id="online_tel" name="online_tel" value="" class="px require" style="width: 300px; margin-top: 10px" size="11" /> <else /> <input type="text" id="online_tel" name="online_tel" value="{weikucms:$online['online_tel']}" class="px require" style="width: 300px;" size="11" /> </if>
							</td>
						</tr>

						<tr>
							<th>在线加盟商地区：</th>
							<td>
								<if condition="$op neq 1"> <input type="text" id="online_zone" name="online_zone" value="" class="px require" style="width: 300px; margin-top: 10px" /> <else /> <input type="text" id="online_zone" name="online_zone" value="{weikucms:$online['online_zone']}" class="px require" style="width: 300px;" /> </if>
							</td>
						</tr>

						<tr>
							<th>在线加盟商地址：</th>
							<td>
								<if condition="$op neq 1"> <input type="text" id="online_address" name="online_address" value="" class="px require" style="width: 300px; margin-top: 10px" /> <else /> <input type="text" id="online_address" name="online_address" value="{weikucms:$online['online_address']}" class="px require" style="width: 300px;" /> </if>
							</td>
						</tr>

                        <tr>
							<th>在线加盟商地址经纬度：</th>
							<td>
								<if condition="$op neq 1">
                                    经度 <input type="text" id="longitude" style="width: 80px;" name="longitude" size="14" class="px" />
                                    纬度 <input type="text" style="width: 80px;" name="latitude" size="14" id="latitude" class="px" />
                                    <a href="###" onclick="setlatlng($('#longitude').val(),$('#latitude').val())">在地图中查看/设置</a>
                                    <else />
                                    经度 <input type="text" id="longitude" style="width: 80px;" name="longitude" size="14" class="px" value="{weikucms:$online['longitude']}" />
                                    纬度 <input type="text" name="latitude" style="width: 80px;" size="14" id="latitude" class="px" value="{weikucms:$online['latitude']}" />
                                    <a href="###" onclick="setlatlng($('#longitude').val(),$('#latitude').val())">在地图中查看/设置</a>
                                </if>
							</td>
						</tr>


						<tr>
							<th>在线加盟商激活登录名：</th>
							<td>
								<if condition="$op neq 1"> <input type="text" id="online_login_name" name="online_login_name" value="" class="px require" style="width: 300px; margin-top: 10px" /> <else /> <input type="text" id="online_login_name" name="online_login_name" value="{weikucms:$online['online_login_name']}" class="px require" style="width: 300px;" /> </if>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
								<span style="padding-top: 5px">在线加盟商登录名称和在线加盟商名称要相同~</span>
							</td>
						</tr>

						<tr>
							<th>在线加盟商激活密码：</th>
							<td>
								<if condition="$op neq 1"> <input type="text" id="online_pwd" name="online_pwd" value="" class="px require" style="width: 300px; margin-top: 10px" /> <else /> <input type="text" id="online_pwd" name="online_pwd" value="{weikucms:$online['online_pwd']}" class="px require" style="width: 300px;" /> </if>
							</td>
						</tr>

						<tr>
							<th>&nbsp;</th>
							<td>
								<if condition="$op neq 1"> <input type="hidden" name="op" id="op" value="0" /> <else /> <input type="hidden" name="op" id="op" value="1" /> </if>
								<button type="button" id="bsubmit" name="button" class="btn btn-primary">
									<if condition="$op neq 1">添加在线加盟商 <else />确定编辑 </if>
								</button>
							</td>
						</tr>
					</tbody>

				</table>
			</div>
		</form>
	</div>
	<div class="cLine">
		<div class="clr"></div>
	</div>
</div>
<script type="text/javascript">
    $(function() {
        $("#bsubmit")
                .click(
                        function() {
                            var brand_id = $("#brand_id").val();
                            var online_id = $("#online_id").val();
                            var online_name = $("#online_name").val().trim();
                            var online_tel = $("#online_tel").val().trim();
                            var online_zone = $("#online_zone").val().trim();
                            var online_address = $("#online_address").val().trim();
                            var longitude = $("#longitude").val().trim();
                            var latitude = $("#latitude").val().trim();
                            var online_pwd = $("#online_pwd").val().trim();
                            var online_login_name = $("#online_login_name").val().trim();
                            var op = $("#op").val();
                            if (!online_name) {
                                notif({
                                    msg : "在线加盟商名称不能为空",
                                    type : "warning"
                                });
                                return false;
                            }
                            if (!online_address) {
                                notif({
                                    msg : "在线加盟商地址不能为空",
                                    type : "warning"
                                });
                                return false;
                            }
                            if (!longitude) {
                                notif({
                                    msg : "在线加盟商纬度不能为空",
                                    type : "warning"
                                });
                                return false;
                            }
                            if (!latitude) {
                                notif({
                                    msg : "在线加盟商经度不能为空",
                                    type : "warning"
                                });
                                return false;
                            }
                            if (!online_tel) {
                                notif({
                                    msg : "在线加盟商电话不能为空",
                                    type : "warning"
                                });
                                return false;
                            }
                            if (online_name !== online_login_name) {
                                notif({
                                    msg : "在线加盟商名称须和在线加盟商登录名一样",
                                    type : "warning"
                                });
                                return false;
                            }
                            var url = "{weikucms::U('Laundry/franchiseemanage',array('token'=>$token))}&brand_id="
                                    + brand_id;
                            $.post(url, {
                                brand_id : brand_id,
                                online_id : online_id,
                                online_name : online_name,
                                online_tel : online_tel,
                                online_zone : online_zone,
                                online_address : online_address,
                                longitude:longitude,
                                latitude:latitude,
                                online_pwd : online_pwd,
                                online_login_name : online_login_name,
                                op : op
                            }, function(data) {
                                if (data.status == 1) {
                                    notif({
                                        msg : data.info,
                                        type : "success"
                                    });
                                    setTimeout(function() {
                                        window.location.href = data.url;
                                    }, '1000');
                                } else {
                                    notif({
                                        msg : data.info,
                                        type : "error"
                                    });
                                }
                            }, 'json');
                        });
    });
</script>
<include file="Public:footer" />