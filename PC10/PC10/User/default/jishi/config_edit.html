<include file="Public:head"/>
<link rel="stylesheet" href="{weikucms::STATICS}/kindeditor/themes/default/default.css" />
<link rel="stylesheet" href="{weikucms::STATICS}/kindeditor/plugins/code/prettify.css" />
<script src="{weikucms::STATICS}/kindeditor/kindeditor.js" type="text/javascript"></script>
<script src="{weikucms::STATICS}/kindeditor/lang/zh_CN.js" type="text/javascript"></script>
<script src="{weikucms::STATICS}/kindeditor/plugins/code/prettify.js" type="text/javascript"></script>
<script src="{weikucms::RES}/js/date/WdatePicker.js"></script>
<script type="text/javascript" src="{weikucms::RES}/js/formCheck/formcheck.js"> </script>
<script>
				var editor,xmeditor,jteditor;
				KindEditor.ready(function(K) {
					editor = K.create('#info', {
					resizeType : 1,
					allowPreviewEmoticons : false,
					allowImageUpload : false,
					items : [
					'source','undo','clearhtml','hr',
					'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
					'insertunorderedlist', '|', 'emoticons', 'image','link', 'unlink','baidumap','lineheight','table','anchor','preview','print','template','code','cut']
					});

					xmeditor = K.create('#xmcontent', {
					resizeType : 1,
					allowPreviewEmoticons : false,
					allowImageUpload : false,
					items : [
					'source','undo','clearhtml','hr',
					'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
					'insertunorderedlist', '|', 'emoticons', 'image','link', 'unlink','baidumap','lineheight','table','anchor','preview','print','template','code','cut']
					});



				jteditor = K.create('#jtcontent', {
					resizeType : 1,
					allowPreviewEmoticons : false,
					allowImageUpload : false,
					items : [
					'source','undo','clearhtml','hr',
					'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
					'insertunorderedlist', '|', 'emoticons', 'image','link', 'unlink','baidumap','lineheight','table','anchor','preview','print','template','code','cut']
					});

				});

				</script>
<script>

$(document).ready(function(){
	$(".pxf").attr("value","0");
	$(".pxf").click(function(){
	        $(this).val($(this).attr("checked")?"1":"0");
	})
})

</script>
<script>
    KindEditor.ready(function(K){
        var editor = K.editor({
            allowFileManager:true
        });
        K('#upload').click(function() {
            editor.loadPlugin('image', function() {
                editor.plugin.imageDialog({
                    fileUrl : K('#piccover').val(),
                    clickFn : function(url, title) {
                        K('#piccover').val(url);
                        editor.hideDialog();
                    }
                });
            });
        });
    });

    KindEditor.ready(function(K){
        var editor = K.editor({
            allowFileManager:true
        });
        K('#upload2').click(function() {
            editor.loadPlugin('image', function() {
                editor.plugin.imageDialog({
                    fileUrl : K('#registrationtoppic').val(),
                    clickFn : function(url, title) {
                        K('#registrationtoppic').val(url);
                        editor.hideDialog();
                    }
                });
            });
        });
    });



</script>

  <div class="cLineB">
    <h4>配置</h4>
</div>
    <div class="alert alert-info">
        <button type="button" class="close" data-dismiss="alert">×</button>
        <strong>提示信息!</strong>
        <ol>
            <li>您可以在此添加配置</li>
        </ol>
    </div>
  <div class="msgWrap">
    <form class="form" method="post"   action="{weikucms::U('Jishi/ConfigSave',array('token'=>$_SESSION['token']))}"  target="_top" enctype="multipart/form-data" >
      <TABLE class="userinfoArea" style=" margin:20px 0 0 0;" border="0" cellSpacing="0" cellPadding="0" width="100%">
        <TBODY>
          <tr>
            <input type="hidden" class="px" id="id" value="{weikucms:$info.id}" name="id" style="width:300px" >
            <input type="hidden" class="px" id="token" value="{weikucms:$_SESSION["token"]}" name="token" style="width:300px" >
            <tr>
                <th valign="top"><label for="keyword">联系我们-电话</label></th>
                <td><input type="input" class="px" id="keyword" value="{weikucms:$info.tel}" name="tel" style="width:300px" >
                </td>
                <td></td>
            </tr>
            <tr>
                <th valign="top"><label for="keyword">联系我们-邮件</label></th>
                <td><input type="input" class="px" id="keyword" value="{weikucms:$info.email}" name="email" style="width:300px" >
                </td>
                <td></td>
            </tr>
            <tr>
                <th valign="top"><label for="keyword">联系我们-传真</label></th>
                <td><input type="input" class="px" id="keyword" value="{weikucms:$info.fax}" name="fax" style="width:300px" >
                </td>
                <td></td>
            </tr>
            <tr>
                <th valign="top"><label for="keyword">客服电话</label></th>
                <td><input type="input" class="px" id="keyword" value="{weikucms:$info.customer_phone}" name="customer_phone" style="width:300px" >
                </td>
                <td></td>
            </tr>
          <tr>
            <th valign="top"><label for="keyword">地址</label></th>
            <td><input type="input" class="px" id="address" value="{weikucms:$info.address}" name="address" style="width:300px" >
              <br />
            </td>
            <td></td>
          </tr>
          <tr>
            <th valign="top"><label for="keyword">经纬地址</label></th>
            <td><div class="control-group">
                <label class="control-label" for="suggestId"></label>
                <div class="controls">
                  <div id="l-map"  style="width:605px; height:320px;"> </div>
                </div>
              </div>
              <div id="r-result">
                <input type="input" class="px" id="lng" value="{weikucms:$info.longitude}"  name="longitude" style="width:80px;">
                <input type="input" class="px" id="lat" value="{weikucms:$info.latitude}"  name="latitude" style="width:80px;">
                <input  type="hidden"  name="city" class="px" id="city" size="20" value=""/>
              </div>
              <div id="searchResultPanel" style="border:1px solid #C0C0C0;width:350px;height:auto;"> </div></td>
          </tr>
        <input type="hidden" class="px" id="hid" value="{weikucms:$info.hid}" name="hid" style="width:300px" >
        <tr>
          <th></th>
          <td><button type="submit"  name="button"  class="btn btn-primary" >保存</button>
              <include file="./tpl/User/default/helper/list_btn.html"/>
            <div class="clr"></div></td>
        </tr>
        </TBODY>

      </TABLE>
    </form>
  </div>
</div>
<script src="{weikucms::RES}/js/baidu.js" type="text/javascript" ></script>
<script type="text/javascript">
var map = new BMap.Map("l-map");
var myGeo = new BMap.Geocoder();
//map.addControl(new BMap.MapTypeControl({mapTypes: [BMAP_NORMAL_MAP,BMAP_HYBRID_MAP]}));     //2D图，卫星图

//map.addControl(new BMap.MapTypeControl({anchor: BMAP_ANCHOR_TOP_LEFT}));    //左上角，默认地图控件

//alert(city);
var currentPoint ;
var marker1;
var marker2;
map.enableScrollWheelZoom();
//var point = new BMap.Point(116.331398,39.897445);

map.enableDragging();
map.enableContinuousZoom();
map.addControl(new BMap.NavigationControl());
map.addControl(new BMap.ScaleControl());
map.addControl(new BMap.OverviewMapControl());

//var point = new BMap.Point(116.331398,39.897445);
var point = new BMap.Point($('#lng').val(),$('#lat').val());
doit(point);
window.setTimeout(function(){
auto();
},100);

 function auto(){
 var geolocation = new BMap.Geolocation();
geolocation.getCurrentPosition(function(r){
if(this.getStatus() == BMAP_STATUS_SUCCESS){
//var mk = new BMap.Marker(r.point);
//map.addOverlay(mk);
 // point = r.point;
//map.panTo(r.point);

var point = new BMap.Point(r.point.lng,r.point.lat);
marker1 = new BMap.Marker(point);        // 创建标注
map.addOverlay(marker1);
var opts = {
width : 220,     // 信息窗口宽度 220-730
height: 60,     // 信息窗口高度 60-650
title : ""  // 信息窗口标题
}
var infoWindow = new BMap.InfoWindow("定位成功这是你当前的位置!,移动红点标注目标位置，你也可以直接修改上方位置,系统自动定位!", opts);  // 创建信息窗口对象
marker1.openInfoWindow(infoWindow);      // 打开信息窗口
doit(point);

}else {

}
})
 }
function  doit(point){

//map.centerAndZoom(point,12);


//myGeo.getPoint(city, function(point){
if (point) {
//window.external.setlngandlat(point.lng,point.lat);
//alert(point.lng + "  ddd " + point.lat);

 document.getElementById('lat').value = point.lat;
  document.getElementById('lng').value =point.lng;
map.setCenter(point);
map.centerAndZoom(point, 15);
map.panTo(point);

var cp = map.getCenter();
myGeo.getLocation(point, function(result){
/*if (result){
 document.getElementById('suggestId').value = result.address;
}	*/
});






marker2 = new BMap.Marker(point);        // 创建标注
var opts = {
width : 220,     // 信息窗口宽度 220-730
height: 60,     // 信息窗口高度 60-650
title : ""  // 信息窗口标题
}
var infoWindow = new BMap.InfoWindow("拖拽地图或红点，在地图上用红点标注您的店铺位置。", opts);  // 创建信息窗口对象
marker2.openInfoWindow(infoWindow);      // 打开信息窗口

map.addOverlay(marker2);                     // 将标注添加到地图中

marker2.enableDragging();
marker2.addEventListener("dragend", function(e){
 document.getElementById('lat').value =e.point.lat;
   document.getElementById('lng').value =e.point.lng;
myGeo.getLocation(new BMap.Point(e.point.lng,e.point.lat), function(result){
if (result){
//$('suggestId').value = result.address;
//$('city').value = result.city;
//			alert(result.address)
//	window.external.setaddress(result.address);//setarrea(result.address);//
//marker1.setPoint(new BMap.Point(e.point.lng,e.point.lat));        // 移动标注
marker2.setPoint(new BMap.Point(e.point.lng,e.point.lat));
map.panTo(new BMap.Point(e.point.lng,e.point.lat));
//window.external.setlngandlat(e.point.lng,e.point.lat);
}
});
});

map.addEventListener("dragend", function showInfo(){
var cp = map.getCenter();
myGeo.getLocation(new BMap.Point(cp.lng,cp.lat), function(result){
if (result){
 //document.getElementById('suggestId').value = result.address;
 document.getElementById('lat').value =cp.lat;
   document.getElementById('lng').value =cp.lng;
//	window.external.setaddress(result.address);//setarrea(result.address);//
//alert(point.lng + "  ddd " + point.lat);
//marker1.setPoint(new BMap.Point(cp.lng,cp.lat));        // 移动标注
marker2.setPoint(new BMap.Point(cp.lng,cp.lat));
map.panTo(new BMap.Point(cp.lng,cp.lat));
//window.external.setlngandlat(cp.lng,cp.lat);
}
});
});

map.addEventListener("dragging", function showInfo(){
var cp = map.getCenter();
//marker1.setPoint(new BMap.Point(cp.lng,cp.lat));        // 移动标注
marker2.setPoint(new BMap.Point(cp.lng,cp.lat));
map.panTo(new BMap.Point(cp.lng,cp.lat));
map.centerAndZoom(marker2.getPoint(), map.getZoom());
});


}


//}, province);


}


function loadmap() {
var province =  document.getElementById('city').value;
var city =   document.getElementById('address').value ;
// 将结果显示在地图上，并调整地图视野
myGeo.getPoint(city, function(point){
if (point) {
//marker1.setPoint(new BMap.Point(point.lng,point.lat));        // 移动标注
marker2.setPoint(new BMap.Point(point.lng,point.lat));
//window.external.setlngandlat(marker2.getPoint().lng,marker2.getPoint().lat);
//alert(point.lng + "  ddd " + point.lat);
 document.getElementById('lat').value =point.lat;
   document.getElementById('lng').value =point.lng;
map.panTo(new BMap.Point(marker2.getPoint().lng,marker2.getPoint().lat));
map.centerAndZoom(marker2.getPoint(), map.getZoom());
}}, province);
}

function setarrea(address,city) {
//$('suggestId').value = address;
//$('city').value=city;
window.setTimeout(function(){
loadmap();
},2000);
}

function initarreawithpoint(lng,lat){
window.setTimeout(function(){
//marker1.setPoint(new BMap.Point(lng,lat));        // 移动标注
marker2.setPoint(new BMap.Point(lng,lat));
//window.external.setlngandlat(lng,lat);
map.panTo(new BMap.Point(lng,lat));
map.centerAndZoom(marker2.getPoint(), map.getZoom());
}, 2000);
}


</script>
<div class="clr"></div>
</div>
</div>
</div>
<!--底部-->
</div>
<include file="Public:footer"/>
