<include file="Public:head"/>
<script src="{weikucms::RES}/js/card/jquery.js"  type="text/javascript" ></script>
<link rel="stylesheet" type="text/css" href="{weikucms::RES}/css/wapwei/victor-client.css">
<link rel="stylesheet" type="text/css" href="{weikucms::RES}/css/cymain.css" />
<script>
    KindEditor.ready(function(K){
        var editor = K.editor({
            allowFileManager:true
        });
        K('#upload').click(function() {
            editor.loadPlugin('image', function() {
                editor.plugin.imageDialog({
                    fileUrl : K('#pic').val(),
                    clickFn : function(url, title) {
                        K('#pic').val(url);
                        $("#cardlogo").attr('src',url);
                        editor.hideDialog();
                    }
                });
            });
        });
    });

</script>



    <div class="cLineB">
        <div class="title_tab" id="topTab">
            <ul class="tab_navs title_tab" data-index="0">

                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenter/index',array('token'=>$token))}" <if condition="$hover eq 1" >class="hover"</if>>用户中心设置</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenter/memberman',array('token'=>$token))}" <if condition="$hover eq 2" >class="hover"</if>>微信会员管理</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenter/salecard',array('token'=>$token))}" <if condition="$hover eq 3" >class="hover"</if>>会员优惠</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenter/scoreman',array('token'=>$token))}" <if condition="$hover eq 4" >class="hover"</if>>积分规则</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenter/userlevel',array('token'=>$token))}" <if condition="$hover eq 6" >class="hover"</if>>会员等级</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenter/notice',array('token'=>$token))}" <if condition="$hover eq 7" >class="hover"</if>>会员通知</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenter/shitimember',array('token'=>$token))}" <if condition="$hover eq 5" >class="hover"</if>>实体会员</a>
                </li>
				                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Integralshop/index',array('token'=>$token))}" <if condition="$hover eq 5" >class="hover"</if>>积分商城</a>
                </li>
                </li>
                <if condition="$token eq '377d6de0d96a1b0f581cd373e24bc896'">
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('SunPool/index',array('token'=>$token))}" <if condition="$hover eq 5" >class="hover"</if>>安装申请</a>
                </li>
                    </if>
            </ul>
        </div>
    </div>


    <div class="row-fluid">
        <ul id="custom_group_navigator_div" class="qb_clearfix unstyled">

            <li class="list-box">
                <div class="list-box__hd list-box__hd_bg_1">总会员</div>
                <div class="list-box__bd">
                    <div class="list-box__count">
                        <strong class="list-box__total" id="NewToday">{weikucms:$membercounts}</strong>
                        <div class="list-box__trend" id="NewToday1" style="display:none;"><i class="icon icon-arrow-down"></i>个</div>
                    </div>

                    <div class="list-box__links"></div>
                </div>
            </li>

            <li class="list-box">
                <div class="list-box__hd list-box__hd_bg_1">今日新增会员</div>
                <div class="list-box__bd">
                    <div class="list-box__count">
                        <strong class="list-box__total" id="NewToday">{weikucms:$daymembercounts}</strong>
                        <div class="list-box__trend" id="NewToday1" style="display:none;"><i class="icon icon-arrow-down"></i>个</div>
                    </div>

                    <div class="list-box__links"></div>
                </div>
            </li>

            <li class="list-box">
                <div class="list-box__hd list-box__hd_bg_1">积分</div>
                <div class="list-box__bd">
                    <div class="list-box__count">
                        <strong class="list-box__total" id="NewToday">{weikucms:$addscore[0].addscore}|{weikucms:$subscore[0].subscore}</strong>
                        <div class="list-box__trend" id="NewToday1" style="display:none;"><i class="icon icon-arrow-down"></i>个</div>
                    </div>

                    <div class="list-box__links"></div>
                </div>
            </li>

            <li class="list-box">
                <div class="list-box__hd list-box__hd_bg_2">金额</div>
                <div class="list-box__bd">
                    <div class="list-box__count">
                        <strong class="list-box__total" id="NewToday">{weikucms:$addmoney[0].addmoney}|{weikucms:$submoney[0].submoney}</strong>
                        <div class="list-box__trend" id="NewToday1" style="display:none;"><i class="icon icon-arrow-down"></i>{}个</div>
                    </div>

                    <div class="list-box__links"></div>
                </div>
            </li>
        </ul>
    </div>

    <div class="msgWrap">

        <div class="box-content">



            <div class="tab-pane fade active in">
                <form action="" method="post" class="form-horizontal form-validate" novalidate="novalidate">
                    <div class="control-group">
                        <label class="control-label">会员编号字母前缀：</label>
                        <div class="controls">
                            <input type="hidden" name="id" id="id" value="{weikucms:$usercenterdata.id}" class="input-small" data-rule-required="true">
                            <input type="text" placeholder="最多4位" name="u_prefix" id="u_prefix" value="{weikucms:$usercenterdata.u_prefix}" class="input-small" data-rule-required="true">
                            &nbsp; &nbsp; &nbsp;
                            手机短信验证： &nbsp; &nbsp; &nbsp;
                            <select name="is_openphone" id="is_openphone">
                                <option value="0"  <if condition="$usercenterdata['is_openphone'] eq 0">selected</if>>关闭</option>
                                <option value="1"  <if condition="$usercenterdata['is_openphone'] eq 1">selected</if>>开启</option>
                            </select>

                            &nbsp; &nbsp; &nbsp; &nbsp; <button id="bsubmit" type="button" data-loading-text="提交中..." class="btn btn-primary">保存</button>

                        </div>


                    </div>
                </form>
            </div>
        </div>
    </div>



    <div class="alert alert-info">
        <button type="button" class="close" data-dismiss="alert">×</button>
        <strong>提示信息!</strong>
        <ol>
            <li>微信用户，普通会员，高级会员都可以在这里展示和管理了</li>
            <li>会员等级是根据会员所有所得的积分得出，只有等级升级，没有降级</li>

        </ol>
    </div>

    <div class="msgWrap">

        <div class="search_bar_class span12">

            <div class="row span10 left_bar">
                <form action="" method="post">
                    <div class="input-group input-group-text">
                        <!--
                        <select class="select-field" id="search_activity_id_eq" name="score">
                            <option value="" <if condition="$score eq '' ">selected</if>>所有用户</option>
                            <volist name="userlevel" id="vo">
                               <option value="{weikucms:$vo.score}" <if condition="$score eq $vo['score']">selected</if>>{weikucms:$vo.name}</option>
                            </volist>
                        </select>
                        -->
                        <input  style="width: 150px;" type="text" name="member_sn" value="{weikucms:$member_sn}" placeholder="输入会员卡号查询模糊查询"/>
                        <input style="width: 150px;" type="text" name="phone" value="{weikucms:$phone}" placeholder="输入会员手机号"/>
                        <input style="width: 120px;" type="text" name="name" value="{weikucms:$name}" placeholder="输入会员名字模糊查询"/>
                        <input type="submit" class="btn btn-primary chaxun_btn" value="查询" >
                    </div>
                </form>
            </div>

            <div class="row span2">
                <a href="{weikucms::U('Usercenter/exportexcel',array('token'=>$token,'status'=>$status,'p'=>$p))}" class="btn btn-primary export_excel">导出Excel</a>
            </div>
        </div>

        <div class="box-content">

            <div class="tab-pane fade active in" id="home">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>会员编号</th>
                        <th>会员头像</th>
                        <th>会员名称</th>
                        <th>会员等级</th>
                        <th>手机</th>
                        <th>积分</th>
                        <th>余额(元)</th>
                        <th>状态</th>
                        <th style="width: 330px;">操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <volist name="list" id="vo">
                        <tr>
                            <td>
                                <if condition="$vo['member_sn'] neq null">
                                    <if condition="$vo['is_bind'] eq 1">
                                        {weikucms:$vo.phone}
                                        <else/>
                                        {weikucms:$vo.member_sn}
                                    </if>

                                    <else/>
                                    未生成
                                </if>
                            </td>
                            <td>
                                <if condition="$vo.fakeid neq null">
                                    <img width="40px" height="40px" src="./upload/weixin_headimg/{weikucms:$vo.fakeid}.png">
                                    <elseif condition="$vo.headimgurl neq null" />
                                    <img width="40px" height="40px" src="{weikucms:$vo.headimgurl}">
                                    <else/>
                                    <img width="40px" height="40px" src="./upload/w_client.jpg">
                                </if>
                            </td>
                            <td>
                                <if condition="$vo['name'] neq null">
                                    {weikucms:$vo.name}
                                    <else/>
                                    {weikucms:$vo.nickname}
                                </if>
                            </td>
                            <td><span style="color:#797171;">{weikucms:$vo.level_name}</span></td>
                            <td>{weikucms:$vo.phone}</td>
                            <td><span class="badge badge-info">{weikucms:$vo.score}</span></td>
                            <td><span class="badge badge-success">{weikucms:$vo.money}</span></td>
                            <td>
                                <if condition="$vo['is_bind_st'] eq 1">
                                        已绑定实体
                                    <else/>
                                        未绑定实体
                                </if>
                            </td>
                            <td>
                                <a href="{weikucms::U('Usercenter/getmember',array('token'=>$token,'id'=>$vo['id']))}" class="btn btn-success">查看用户</a>
                                <a href="{weikucms::U('Usercenter/scorerecord',array('openid'=>$vo['openid'],'token'=>$token))}" class="btn btn-success">积分记录</a>
                                <a href="{weikucms::U('Usercenter/moneyrecord',array('openid'=>$vo['openid'],'token'=>$token))}" class="btn btn-success">消费记录</a>
                            </td>
                        </tr>
                    </volist>
                    </tbody>
                </table>

            </div>
            <div>
                <ul class="pager">
                    {weikucms:$page}
                </ul>
            </div>


        </div>



    </div>
    <include file="Public:footer"/>

    <script type="text/javascript">
        $(function(){
            $("#bsubmit").click(function(){
                var id = $("#id").val();
                var u_prefix = $("#u_prefix").val();
                var is_openphone = $("#is_openphone").val();
                var __hash__ =  $("input[name='__hash__']").val();
                if(!id){
                    notif({
                        msg:"请先到用户中心设置",
                        type: "warning"
                    });
                    return false;
                }

                var patter = /\d+$/;

                if(u_prefix){
                    if(u_prefix.length > 6){
                        notif({
                            msg:"会员编号前缀最多输入6位",
                            type: "warning"
                        });
                        return false;
                    }
                }


                $.post("{weikucms::U('Usercenter/uprefixset',array('token'=>$token))}",
                        {id:id,u_prefix:u_prefix,is_openphone:is_openphone,__hash__:__hash__},
                        function(data){
                            if(data.status == 1){
                                notif({
                                    msg: data.info,
                                    type: "success"
                                });
                                setTimeout(function(){
                                    window.location.reload();
                                },'1000');
                            }else{
                                notif({
                                    msg: data.info,
                                    type: "error"
                                });
                            }
                        },'json');

            });
        });

    </script>

</div>
