<include file="Public:head"/>
<link rel="stylesheet" href="{weikucms::STATICS}/kindeditor/themes/default/default.css" />
<link rel="stylesheet" href="{weikucms::STATICS}/kindeditor/plugins/code/prettify.css" />
<script src="{weikucms::STATICS}/kindeditor/kindeditor.js" type="text/javascript"></script>
<script src="{weikucms::STATICS}/kindeditor/lang/zh_CN.js" type="text/javascript"></script>
<script src="{weikucms::STATICS}/kindeditor/plugins/code/prettify.js" type="text/javascript"></script>
<script>

var editor;
KindEditor.ready(function(K) {
editor = K.create('#info', {
resizeType : 1,
allowPreviewEmoticons : false,
allowImageUpload : true,
allowFileManager:true
});

});
</script>
<script>
    KindEditor.ready(function(K){
        var editor = K.editor({
            allowFileManager:true
        });
        K('#upload').click(function() {
            editor.loadPlugin('image', function() {
                editor.plugin.imageDialog({
                    fileUrl : K('#pic').val(),
                    clickFn : function(url, title) {
                        K('#pic').val(url);
                        $("#image_show").attr('src',url).show();
                        editor.hideDialog();
                    }
                });
            });
        });
    });


</script>

<script>
    KindEditor.ready(function(K){
        var editor = K.editor({
            allowFileManager:true
        });
        K('#upload1').click(function() {
            editor.loadPlugin('image', function() {
                editor.plugin.imageDialog({
                    fileUrl : K('#pic1').val(),
                    clickFn : function(url, title) {
                        K('#pic1').val(url);
//                        $("#image_show").attr('src',url).show();
                        editor.hideDialog();
                    }
                });
            });
        });
    });
</script>

<script>
    KindEditor.ready(function(K){
        var editor = K.editor({
            allowFileManager:true
        });
        K('#upload2').click(function() {
            editor.loadPlugin('image', function() {
                editor.plugin.imageDialog({
                    fileUrl : K('#pic2').val(),
                    clickFn : function(url, title) {
                        K('#pic2').val(url);
//                        $("#image_show").attr('src',url).show();
                        editor.hideDialog();
                    }
                });
            });
        });
    });
</script>

<script>
    KindEditor.ready(function(K){
        var editor = K.editor({
            allowFileManager:true
        });
        K('#upload3').click(function() {
            editor.loadPlugin('image', function() {
                editor.plugin.imageDialog({
                    fileUrl : K('#pic3').val(),
                    clickFn : function(url, title) {
                        K('#pic3').val(url);
//                        $("#image_show").attr('src',url).show();
                        editor.hideDialog();
                    }
                });
            });
        });
    });
</script>


          <div class="cLineB"><h4>编辑图文自定义内容</h4></div>
         
          
          <!--复制开始-->    
      <div class="cLineB" id="uppict" style="display:none">    

 </div> 
 
 <!--复制结束--> 
 <form method="post"   action=""  enctype="multipart/form-data" >
          <div class="msgWrap form">
            <TABLE class="userinfoArea" border="0" cellSpacing="0" cellPadding="0" width="100%">
              <THEAD>
                <TR>
                  <TH style="width:120px" valign="top"><label for="keyword">关键词：</label></TH>
                  <TD><input type="input" class="px" id="keyword" value="{weikucms:$info.keyword}"  name="keyword" style="width:300px;" placeholder="例如: 万普微盟 "> </TD>
                </TR>
                
                
              </THEAD>
              <TBODY>
               <TR>
                  <TH><label for="title">图文消息标题：</label></TH>
                  <TD><input type="input" class="px" id="title" value="{weikucms:$info.title}"    name="title" style="width:300px;" onfocus="leave();"> </TD>
                </TR>
                <TR>
                  <TH valign="top"><label for="text">简介：</label></TH>
                  <TD><textarea  class="px" id="Hfcontent"     name="text" style="width:300px;  height:100px" >{weikucms:$info.text}</textarea><br />最多输入200个汉字</TD>
                </TR>
                <TR>
                  <TH valign="top"><label for="classid">图文消息所属类别：</label></TH>
                  <TD>
                   <select name="classid"   > 
                  
                      <volist name="send" id="vo">
                      
                    <!-- <option   value="{weikucms:$vo.id},{weikucms:$vo.name}"  <if condition="$vo['id'] eq $info['classid']">selected="selected" </if>>{weikucms:$vo.name}</option> -->
                     <option style="text-indent:{weikucms:$vo['Count']*20}px;" value="{weikucms:$vo.id},{weikucms:$vo.name}" <if condition="$vo['id'] eq $info['classid']">selected="selected" </if>><neq name="vo.Count" value="1"><php>echo str_repeat('&nbsp;',$vo['Count']*6);</php>|---</neq>{weikucms:$vo.name} </option>
                      
                   
                      </volist>      
                    </select><a href="{weikucms::U('Classify/add')}"  class="btn btn-primary add_fenlei">添加分类</a>
                  </TD>
                </TR>
               <TR>
                   <TH valign="top"><label for="picurl">封面图片：</label></TH>

                   <TD><img id="image_show" class="indexs_img" src="{weikucms:$info.pic}"></TD>
               </TR>
               <TR>
                   <TH valign="top"><label for="pic">上传封面图片：</label></TH>
                   <TD><input type="hidden" class="text textMiddle inputQ"  name="pic" id="pic" value="{weikucms:$info.pic}" style="width:300px;"   />
                       <span class="ke-button-common" id="upload">上传图片</span>
                   </TD>
               </TR>

               <TR>
                   <th valign="top">展示图片一：</th>
                   <TD>
                       <input type="text" class="px" id="pic1" name="pic1"  value="{weikucms:$info.pic1}" style="width: 400px;" readonly/>
                       <span class="ke-button-common" id="upload1">上传图片</span>
                   </TD>
               </TR>

               <TR>
                   <th valign="top">展示图片二：</th>
                   <TD>
                       <input type="text" class="px" id="pic2" name="pic2" value="{weikucms:$info.pic2}" style="width: 400px;" readonly/>
                       <span class="ke-button-common" id="upload2">上传图片</span>
                   </TD>
               </TR>

               <TR>
                   <th valign="top">展示图片三：</th>
                   <TD>
                       <input type="text" class="px" id="pic3" name="pic3"  value="{weikucms:$info.pic3}" style="width: 400px;" readonly/>
                       <span class="ke-button-common" id="upload3">上传图片</span>
                   </TD>
               </TR>

				<input type="hidden" name="id" value="{weikucms:$info.id}" />
               <TR>
                  <TH valign="top"><label for="showpic">详细页是否显示封面：</label></TH>
                  <TD>
				  是<input class="radio" type="radio" name="showpic" value="1" <eq name="info.showpic" value="1"> checked="checked"</eq> />
				  否<input class="radio" type="radio" name="showpic" value="0" <eq name="info.showpic" value="0"> checked="checked"</eq> />
                  
</TD>
                </TR>
                <TR>
                  <TH valign="top"><label for="info">图文详细页内容：</label></TH>
                  <TD><textarea name="info" id="info"  rows="5" style="width:590px;height:360px" onfocus="leave();">{weikucms:$info.info}</textarea></TD>
                </TR>  
                 <TR>
                  <TH valign="top"><label for="url">自定义链接地址：</label></TH>
                  <TD><input type="input" class="px" id="url" value="{weikucms:$info.url}" name="url" style="width:500px;" placeholder="如果填写了图文详细内容，这里请留空，不要设置！"></TD>
                </TR>

               <TR>
                   <TH valign="top"><label for="info">是否开启转发：</label></TH>
                   <TD>
                       <select name="is_zf" id="is_zf">
                           <option value="2" <if condition="$info['is_zf'] eq 2">selected</if>>不开启</option>
                           <option value="1" <if condition="$info['is_zf'] eq 1">selected</if>>开启</option>
                       </select>
                   </TD>
               </TR>

               <TR>
                   <TH valign="top"><label for="is_redpay">选择现金红包：</label></TH>
                   <TD>
                       <select name="is_redpay" id="is_redpay">
                           <option value="0">不开启现金红包</option>
                           <if condition="$aRedpay">
                               <volist name="aRedpay" id="red">
                                   <option value="{weikucms:$red.id}" <if condition="$info['is_redpay'] eq $red['id']">selected</if>>{weikucms:$red.act_name}</option>
                               </volist>
                               <else/>
                               <option value="">暂无现金红包活动</option>
                           </if>
                       </select>
                   </TD>
               </TR>


               <TR>
                   <TH valign="top"><label for="info">转发一次获得积分数：</label></TH>
                   <TD>
                       <input type="input" class="px" id="score" value="{weikucms:$info.score}" name="score" style="width:300px;" placeholder="设置转发一次获得的积分数需转发开启才有效">
                   </TD>
               </TR>

               <TR>
                   <TH valign="top"><label for="info">排序号：</label></TH>
                   <TD>
                       <input type="input" class="px" id="store" value="{weikucms:$info.store}" name="store" style="width:300px;" placeholder="请填写排序号"><span>提示：可以为负数，数字越小则在前端的同类里面排序越靠前</span>
                   </TD>
               </TR>

                <TR>
                  <TH></TH>
                  <TD><button type="button" id="bsubmit"  name="sbmt" class="btn btn-primary">保存</button>　</TD>
                </TR>
               <TR style="height: 150px;">

               </TR>
              </TBODY>
            </TABLE>
            
          </div>
          </form>
          
        </div>     
 
        <div class="clr"></div>
      </div>
    </div>
  </div> 
<!--底部-->
  	</div>
<script type="text/javascript">
    $(function(){
        $("#bsubmit").click(function(){
            var keyword = $("#keyword").val();
            var title = $("#title").val();
            var text = $("#Hfcontent").val();
            var pic = $("#pic").val();
            var pic1 = $("#pic1").val();
            var pic2 = $("#pic2").val();
            var pic3 = $("#pic3").val();
            var is_zf = $("#is_zf").val();
            var score = $("#score").val();
            var showpic = $("input[name='showpic']:checked").val();
            var info = editor.html();
            var url = $("#url").val();
            var store = $('#store').val();
            var is_redpay = $("#is_redpay").val();
            var classid = $("select[name='classid']").val();
            var __hash__ =  $("input[name='__hash__']").val();
            var id =  $("input[name='id']").val();
            if(! keyword){
                notif({
                    msg: "关键词不能为空哦",
                    type: "warning"
                });
                return false;
            }

            if(! title){
                notif({
                    msg: "回复标题不能为空哦",
                    type: "warning"
                });
                return false;
            }

            if(! text){
                notif({
                    msg: "回复简介不能为空哦",
                    type: "warning"
                });
                return false;
            }

            if(! pic){
                notif({
                    msg: "您还没上传封面图片哦",
                    type: "warning"
                });
                return false;
            }

            var patter =  /^[0-9]+.?[0-9]*$/;
            if(is_zf == 1) {
                if (!patter.test(score)) {
                    notif({
                        msg: "请输入积分合法数字",
                        type: "warning"
                    });
                    return false;
                }
            }

//            if(! pic1 && !pic2 && !pic3){
//                notif({
//                    msg: "展示图片必须有一项",
//                    type: "warning"
//                });
//                return false;
//            }

            if(!url){
                if(! info){
                    notif({
                        msg: "详细内容页面不能为空",
                        type: "warning"
                    });
                    return false;
                }
            }

            if(url == ''){
                if(info == ''){
                    notif({
                        msg: "详细内容页面不能为空",
                        type: "warning"
                    });
                    return false;
                }
            }

            $.post("{weikucms::U('Img/upsave',array('seach'=>$_GET['seach']))}",
                    {id:id,keyword:keyword,title:title,text:text,store:store,pic:pic,pic1:pic1,pic2:pic2,pic3:pic3,is_zf:is_zf,score:score,showpic:showpic,info:info,url:url,classid:classid,is_redpay:is_redpay,__hash__:__hash__},
                    function(data){
                        if(data.status == 1){
                            notif({
                                msg: data.info,
                                type: "success"
                            });
                            setTimeout(function(){
                                window.location.href = data.url;
                            },'1000');
                        }else{
                            notif({
                                msg: data.info,
                                type: "error"
                            });
                        }
                    },'json');

        });
    });

</script>
<include file="Public:footer"/>