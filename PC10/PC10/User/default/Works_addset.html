<include file="Public:head" />
<link rel="stylesheet" href="{weikucms::STATICS}/kindeditor/themes/default/default.css" />
<link rel="stylesheet" href="{weikucms::STATICS}/kindeditor/plugins/code/prettify.css" />
<script src="{weikucms::STATICS}/kindeditor/kindeditor.js" type="text/javascript"></script>
<script src="{weikucms::STATICS}/kindeditor/lang/zh_CN.js" type="text/javascript"></script>
<script src="{weikucms::STATICS}/kindeditor/plugins/code/prettify.js" type="text/javascript"></script>
<script src="/tpl/static/artDialog/jquery.artDialog.js?skin=default"></script>
<script src="/tpl/static/artDialog/plugins/iframeTools.js"></script>
<script src="{weikucms::RES}/js/date/WdatePicker.js"></script>

<script>
    var editor1;
    KindEditor.ready(function(K) {
        editor1 = K.create('#explain', {
            resizeType : 1,
            allowPreviewEmoticons : false,
            allowImageUpload : true,
            uploadJson : '/index.php?g=User&m=Upyun&a=kindedtiropic',
            items : [
                'source','undo','clearhtml','hr',
                'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
                'insertunorderedlist', '|', 'emoticons', 'image','link', 'unlink','baidumap','lineheight','table','anchor','preview','print','template','code','cut', 'music', 'video'],
            afterBlur: function(){this.sync();}
        });
    });
</script>

<script>
    var editor2;
    KindEditor.ready(function(K) {
        editor2 = K.create('#entry', {
            resizeType : 1,
            allowPreviewEmoticons : false,
            allowImageUpload : true,
            uploadJson : '/index.php?g=User&m=Upyun&a=kindedtiropic',
            items : [
                'source','undo','clearhtml','hr',
                'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
                'insertunorderedlist', '|', 'emoticons', 'image','link', 'unlink','baidumap','lineheight','table','anchor','preview','print','template','code','cut', 'music', 'video'],
            afterBlur: function(){this.sync();}
        });
    });
</script>

<script>
    var editor3;
    KindEditor.ready(function(K) {
        editor3 = K.create('#vote', {
            resizeType : 1,
            allowPreviewEmoticons : false,
            allowImageUpload : true,
            uploadJson : '/index.php?g=User&m=Upyun&a=kindedtiropic',
            items : [
                'source','undo','clearhtml','hr',
                'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
                'insertunorderedlist', '|', 'emoticons', 'image','link', 'unlink','baidumap','lineheight','table','anchor','preview','print','template','code','cut', 'music', 'video'],
            afterBlur: function(){this.sync();}
        });
    });
</script>

<script>
    var editor4;
    KindEditor.ready(function(K) {
        editor4 = K.create('#awaedrul', {
            resizeType : 1,
            allowPreviewEmoticons : false,
            allowImageUpload : true,
            uploadJson : '/index.php?g=User&m=Upyun&a=kindedtiropic',
            items : [
                'source','undo','clearhtml','hr',
                'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
                'insertunorderedlist', '|', 'emoticons', 'image','link', 'unlink','baidumap','lineheight','table','anchor','preview','print','template','code','cut', 'music', 'video'],
            afterBlur: function(){this.sync();}
        });
    });
</script>

<script>
    var editor5;
    KindEditor.ready(function(K) {
        editor5 = K.create('#awards', {
            resizeType : 1,
            allowPreviewEmoticons : false,
            allowImageUpload : true,
            uploadJson : '/index.php?g=User&m=Upyun&a=kindedtiropic',
            items : [
                'source','undo','clearhtml','hr',
                'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
                'insertunorderedlist', '|', 'emoticons', 'image','link', 'unlink','baidumap','lineheight','table','anchor','preview','print','template','code','cut', 'music', 'video'],
            afterBlur: function(){this.sync();}
        });
    });
</script>

<script>
    var editor6;
    KindEditor.ready(function(K) {
        editor6 = K.create('#gain', {
            resizeType : 1,
            allowPreviewEmoticons : false,
            allowImageUpload : true,
            uploadJson : '/index.php?g=User&m=Upyun&a=kindedtiropic',
            items : [
                'source','undo','clearhtml','hr',
                'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
                'insertunorderedlist', '|', 'emoticons', 'image','link', 'unlink','baidumap','lineheight','table','anchor','preview','print','template','code','cut', 'music', 'video'],
            afterBlur: function(){this.sync();}
        });
    });
</script>

<script>
    var editor7;
    KindEditor.ready(function(K) {
        editor7 = K.create('#coupon', {
            resizeType : 1,
            allowPreviewEmoticons : false,
            allowImageUpload : true,
            uploadJson : '/index.php?g=User&m=Upyun&a=kindedtiropic',
            items : [
                'source','undo','clearhtml','hr',
                'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
                'insertunorderedlist', '|', 'emoticons', 'image','link', 'unlink','baidumap','lineheight','table','anchor','preview','print','template','code','cut', 'music', 'video'],
            afterBlur: function(){this.sync();}
        });
    });
</script>

<script>
    var editor8;
    KindEditor.ready(function(K) {
        editor8 = K.create('#accept', {
            resizeType : 1,
            allowPreviewEmoticons : false,
            allowImageUpload : true,
            uploadJson : '/index.php?g=User&m=Upyun&a=kindedtiropic',
            items : [
                'source','undo','clearhtml','hr',
                'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
                'insertunorderedlist', '|', 'emoticons', 'image','link', 'unlink','baidumap','lineheight','table','anchor','preview','print','template','code','cut', 'music', 'video'],
            afterBlur: function(){this.sync();}
        });
    });
</script>

<script>
    var editor9;
    KindEditor.ready(function(K) {
        editor9 = K.create('#law', {
            resizeType : 1,
            allowPreviewEmoticons : false,
            allowImageUpload : true,
            uploadJson : '/index.php?g=User&m=Upyun&a=kindedtiropic',
            items : [
                'source','undo','clearhtml','hr',
                'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
                'insertunorderedlist', '|', 'emoticons', 'image','link', 'unlink','baidumap','lineheight','table','anchor','preview','print','template','code','cut', 'music', 'video'],
            afterBlur: function(){this.sync();}
        });
    });
</script>


<script>
    KindEditor.ready(function(K){
        var editor = K.editor({
            allowFileManager:true
        });
        K('#upload').click(function() {
            editor.loadPlugin('image', function() {
                editor.plugin.imageDialog({
                    fileUrl : K('#pic').val(),
                    clickFn : function(url, title) {
                        K('#pic').val(url);
                        $("#image_show").attr('src',url).show();
                        editor.hideDialog();
                    }
                });
            });
        });
    });

</script>

<div class="">
    <div class="cLineB">
        <h4 style="position:relative;">
            添加比赛活动
            <a type="button" name="button" class="btn btn-primary" style="position:absolute;right:0px;top:-10px;height:185%;padding:0 40px;line-height:35px;" href="{weikucms::U('Works/index',array('token'=>$token,'catid'=>$catid))}">
                返回
            </a>
        </h4>
    </div>

    <!--复制开始-->
    <div class="cLineB" id="uppict" style="display:none">
        <script>
            function selurl() {

                var url = document.getElementById("url");
                var select1 = document.getElementById("select");
                url.value = select1.value;
            }
        </script>
    </div>
    <!--复制结束-->

    <div class="msgWrap">
        <form class="form" method="post" action="" target="_top" enctype="multipart/form-data">
            <table class="userinfoArea" style="ma" border="0" cellSpacing="0" cellPadding="0" width="100%">
                <tr>
                    <th valign="top">比赛活动名称：</th>
                    <td>
                        <input type="input" class="px" id="name" value="{weikucms:$set.name}" name="name" style="width:300px" placeholder="此处填写比赛活动的名字">
                    </td>
                </tr>
                <tr>
                    <th valign="top">活动主题：</th>
                    <td>
                        <input type="input" class="px" id="title" value="{weikucms:$set.title}" name="title" style="width:300px" placeholder="此处填写比赛活动主题">
                    </td>
                </tr>

                <tr>
                    <th valign="top">适用范围：</th>
                    <td>
                        <input type="input" class="px" id="extent" value="{weikucms:$set.extent}" name="extent" style="width:50px" placeholder="此处填写参加比赛的年龄限制">岁以下
                    </td>
                </tr>
                <tr>
                    <th valign="top"> 主题图片：</th>
                    <td>
                        <img  id="image_show" class="indexs_img" src="{weikucms:$set.pic}">
                        <input type="hidden" class="text textMiddle inputQ"  name="pic" id="pic" value="{weikucms:$set.pic}" style="width:300px;"   />
                        <span class="ke-button-common" id="upload" style="margin-left: 5px;">上传礼品图片</span>
                    </td>
                    <td>
                        &nbsp;
                    </td>
                </tr>

                <tr>
                    <th>截至时间：</th>
                    <td><input type="input" class="px" id="starttime" value="{weikucms:$set.starttime}" onClick="WdatePicker()" name="starttime" style="width:175px;"/>
                        到
                        <input type="input" class="px" id="endtime" value="{weikucms:$set.endtime}" name="endtime" onClick="WdatePicker()" style="width:175px;"></td>
                </tr>

                <tr>
                    <th>活动奖品优惠券:</th>
                    <td>
                        <select name="sid"  class="select" id="sid">
                            <option value="">请选择</option>
                            <volist name="list" id="vo">
                                <option value="{weikucms:$vo.id}" <if condition="$set['sid'] eq $vo['id'] ">selected</if>>{weikucms:$vo.snname}</option>
                            </volist>
                        </select>
                    </td>
                </tr>

                <tr>
                    <th valign="top">活动范围：</th>
                    <td valign="top"><textarea class="px" id="explain" name="explain" style="width: 590px; height: 120px;">{weikucms:$set.explain}</textarea></td>
                </tr>

                <tr>
                    <th valign="top">参赛规则：</th>
                    <td valign="top">
                        <textarea id="entry" class="px" name="entry" style="width: 590px; height: 120px;">{weikucms:$set.entry}</textarea>
                    </td>
                </tr>

                <tr>
                    <th valign="top">投票规则：</th>
                    <td valign="top">
                        <textarea id="vote" class="px" name="vote" style="width: 590px; height: 120px;">{weikucms:$set.vote}</textarea>
                    </td>
                </tr>

                <tr>
                    <th valign="top">评奖规则：</th>
                    <td valign="top">
                        <textarea id="awaedrul" class="px" name="awaedrul" style="width: 590px; height: 120px;">{weikucms:$set.awaedrul}</textarea>
                    </td>
                </tr>

                <tr>
                    <th valign="top">比赛奖项：</th>
                    <td valign="top">
                        <textarea id="awards" class="px" name="awards" style="width: 590px; height: 120px;">{weikucms:$set.awards}</textarea>
                    </td>
                </tr>

                <tr>
                    <th valign="top">活动优惠券获得规则：</th>
                    <td valign="top">
                        <textarea id="gain" class="px" name="gain" style="width: 590px; height: 120px;">{weikucms:$set.gain}</textarea>
                    </td>
                </tr>

                <tr>
                    <th valign="top">活动优惠券使用说明：</th>
                    <td valign="top">
                        <textarea id="coupon" class="px" name="coupon" style="width: 590px; height: 120px;">{weikucms:$set.coupon}</textarea>
                    </td>
                </tr>

                <tr>
                    <th valign="top">奖项须知：</th>
                    <td valign="top">
                        <textarea id="accept" class="px" name="accept" style="width: 590px; height: 120px;">{weikucms:$set.accept}</textarea>
                    </td>
                </tr>

                <tr>
                    <th valign="top">法律声明：</th>
                    <td valign="top">
                        <textarea id="law" class="px" name="law" style="width: 590px; height: 120px;">{weikucms:$set.law}</textarea>
                    </td>
                </tr>


                <tr>
                    <th>
                    </th>
                    <td>
                        <input type="hidden" name="id" id="id" value="{weikucms:$set.id}" />
                        <button type="button" id="bsubmit" name="button" class="btn btn-primary">
                            保存
                        </button>
                        <div class="clr">
                        </div>
                    </td>
                </tr>


            </table>
        </form>
    </div>

    <div class="clr">
    </div>
</div>
</div>
</div>

</div>
<script type="text/javascript">
    $(function(){
        $("#bsubmit").click(function(){
            var name = $("#name").val();
            var title = $("#title").val();
            var extent = $("#extent").val();
            var pic = $("#pic").val();
            var starttime = $("#starttime").val();
            var endtime =$("#endtime").val();
            var sid =$("#sid").val();

            var explain = editor1.html();

            var entry =editor2.html();

            var vote =editor3.html();

            var awaedrul =editor4.html();

            var awards =editor5.html();
            var coupon =editor6.html();
            var gain =editor7.html();
            var accept =editor8.html();
            var law =editor9.html();
            var id = $("#id").val();




            if(!sid){
                notif({
                    msg: "请选择优惠券",
                    type: "warning"
                });
                return false;
            }

            if(! name){
                notif({
                    msg: "比赛活动名称不能为空哦",
                    type: "warning"
                });
                return false;
            }
            if(! title){
                notif({
                    msg: "比赛活动主题不能为空哦",
                    type: "warning"
                });
                return false;
            }


            if(! extent){
                notif({
                    msg: "适用范围不能为空哦",
                    type: "warning"
                });
                return false;
            }

            if(! starttime){
                notif({
                    msg: "开始日期不能为空",
                    type: "warning"
                });
                return false;
            }
            if(! endtime){
                notif({
                    msg: "结束日期不能为空",
                    type: "warning"
                });
                return false;
            }

            if(! explain){
                notif({
                    msg: "活动详情不能为空",
                    type: "warning"
                });
                return false;
            }
            //explain  coupon  entry  vote  awards gain accept law
            var posturl = "{weikucms::U('Works/append',array('token'=>$token))}";
            $.post(posturl,
                    {name:name,title:title,extent:extent,pic:pic,starttime:starttime,endtime:endtime,sid:sid,explain:explain,coupon:coupon,entry:entry,vote:vote,awards:awards,gain:gain,accept:accept,law:law,awaedrul:awaedrul,id:id},
                    function(data){
                        if(data.status == 1){
                            notif({
                                msg: data.info,
                                type: "success"
                            });
                            setTimeout(function(){
                                window.location.href = data.url;
                            },'1000');
                        }else{
                            notif({
                                msg: data.info,
                                type: "error"
                            });
                        }
                    },'json');
            // window.location.href="{weikucms::U('Classify/insert',array(token=>$token))}";
        });
    });

</script>

<include file="Public:footer" />


