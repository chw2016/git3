<!DOCTYPE html>
<html lang="en">
    <head>
	        <meta charset="utf-8">
	        <meta name="author" content="Wapwei,Manning,Samphay@163.com">
	        <meta name="apple-mobile-web-app-capable" content="yes">
			<meta name="apple-mobile-web-app-status-bar-style" content="black">
			<meta name="apple-mobile-web-app-title" content="">
			<meta name="format-detection" content="telphone=no, email=no"/>
			<meta content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no,minimal-ui" name="viewport">
			<title>{weikucms:$tpl.name}设置中心</title>
			<link rel="stylesheet" href="{weikucms::STATICS}/wapweiui/Intel/css/paipai.css">
			<script src="{weikucms::STATICS}/wapweiui/Intel/js/jquery-1.11.1.min.js"></script>
			<script type="text/javascript" src="{weikucms::STATICS}/wapweiui/Intel/js/paipai.js"></script>
    <script type="text/javascript" src="{weikucms::STATICS}/common/f.js"></script>
    <script type="text/javascript" src="{weikucms::STATICS}/common/msg.js"></script>
       <style>
.equipment{position: absolute;right: 5px;display: none;font-size: 12px;}
.equipment ul{border-radius: 5px;background-color: #FFFFFF;color: #000;border: 1px solid #ccc;}
.equipment ul li{list-style: none;line-height: 40px;text-align: center;}
       </style>
       <script>
    	 $(function(){
    	$(document).on('click','.number.on',function(){
    		$(".equipment").css("display","block");
    	})
    	$(document).on('touchstart','.equipment ul li',function(event){
    		event.preventDefault();
    		$(".equipment").css("display","none");
    		$(".no").html($(this).html());
            $('#imei').val($.trim($(this).html()));
    	})

        $('.device').click(function(){
            //$(this).find('.Arrow').trigger('click');
        })
    })
    </script>
    </head>
    <body class="bodys">
	    <section class="device">
	    	<div class="showimg">
	    		<img src="{weikucms::STATICS}/wapweiui/Intel/imgs/mobile.jpg" alt="mobile" />
	    	</div>
	    	<div class="choice">
	    		选择设备
	    	</div>
	    	<div class="number on">
                <!--<select id='imei'>
                    <if condition="bindList neq null">
                    <volist name="bindList" id="list">
                    <option value="{weikucms:$list.imei}">{weikucms:$list.imei}</option>
                    </volist>
                    <else/>
                    <option value="">暂无设备</option>
                    </if>
                </select>-->
                <if condition="bindList neq null">
                <div class="no" style="font-size: 12px;">
                    {weikucms:$imei}
                </div>
                <input type="hidden" id="imei" value="{weikucms:$imei}">
                <div class="equipment" style="width: 97%;z-index: 999999;">
                	<ul>
                <volist name="bindList" id="list">
                    <li>{weikucms:$list.imei}</li>
                </volist>
                	</ul>
                </div>
                <else/>
                <div  class="no" style="font-size: 12px;">
                    暂时没有绑定设备
                </div>
                </if>
	    	</div>
	    	<div class="arrow">
	    		<div class="arrows"></div>
	    	</div>
	    </section>
	    <!-- 实时拍照 -->
	    <section class="device">
	    	<div class="showimg photo">
	    		<img src="{weikucms::STATICS}/wapweiui/Intel/imgs/photo.jpg" alt="photo" />
	    	</div>
	    	<div class="choice">
	    		实时拍照
	    	</div>
	    	<div class="number">
	    	</div>
	    	<div class="arrow Arrow" style="display: none;">
	    	    <div class="add">
	    	    	+
	    	    </div>
	    	</div>
	    </section>
	    <!-- 实时拍照弹出框 -->
	    <div class="always-set" style="display:none;">
	    	<div class="list second">
	    	    <div class="left"></div>
	    	    <div class="middle">图片大小</div>
	    		<div class="right"></div>
	    	</div>
	    	<div class="list second special">
	    	    <div class="left"></div>
	    		<div class="middle picsize" data-id='1'>小</div>
	    		<div class="right">
				    <div class="blue-arrow marginTop"></div>
	    		</div>
	    	</div>
	    	<!-- 大中小显示 -->
	    	<div class="list second sizes pic" style="display:none;">
	    	    <div class="left"></div>
	    		<div class="middle" data-id="1">小</div>
	    		<div class="right">

	    		</div>
	    	</div>
	    	<div class="list second sizes pic" style="display:none;">
	    	    <div class="left"></div>
	    		<div class="middle" data-id='2'>大</div>
	    		<div class="right">

	    		</div>
	    	</div>
	    </div>
        <!--显示图片-->
        <div id="dyGetPhoto" style="display: none; width: 93%;padding: 10px;">
            <img src="{weikucms::STATICS}/Desert.jpg" alt="tupian" style="width: 100%">
        </div>

	    <!-- 获取防盗图片 -->
	    <div class="anti getpic">
	        <div class="left"></div>
	        <div class="middle">获取防盗图片</div>
	        <div class="right">
	        	<img src="{weikucms::STATICS}/wapweiui/Intel/imgs/i.jpg" />
	        </div>
	    </div>
	    <!-- 实时视频 -->
	    <section class="device">
	    	<div class="showimg video">
	    		<img src="{weikucms::STATICS}/wapweiui/Intel/imgs/film.jpg" alt="vedio" />
	    	</div>
	    	<div class="choice">
	    		实时视频
	    	</div>
	    	<div class="number">
	    	</div>
	    	<div class="arrow Arrow" style="display: none;">
	    	    <div class="add">+</div>
	    	</div>
	    </section>
	    <!-- 车辆设置 -->
	    <!-- 实时视频弹出框 -->
	    <div class="always-set" style="display:none;">
	    	<div class="list second">
	    	    <div class="left"></div>
	    	    <div class="middle">视频时间</div>
	    		<div class="right"></div>
	    	</div>
	    	<div class="list second special" style="display: none;">
	    	    <div class="left"></div>
	    		<div class="middle videotime">5秒</div>
	    		<div class="right">
				    <div class="blue-arrow marginTop"></div>
	    		</div>
	    	</div>
	    	<!-- 时间显示 -->
	    	<div class="list second sizes video" style="display:none;">
	    	    <div class="left"></div>
	    		<div class="middle">5秒</div>
	    		<div class="right">

	    		</div>
	    	</div>
	    	<div class="list second sizes video" style="display:none;">
	    	    <div class="left"></div>
	    		<div class="middle">10秒</div>
	    		<div class="right">

	    		</div>
	    	</div>
	    	<div class="list second sizes video" style="display:none;">
	    	    <div class="left"></div>
	    		<div class="middle">30秒</div>
	    		<div class="right">

	    		</div>
	    	</div>
	    </div>
        <!--显示视频-->
        <div id="playScreen" style="display: none; margin: 0 auto; width: 95%;">
            <video id="myVideo" style="width: 100%;">
                <source src="" type="video/mp4">
            </video>
            <a style="color: rgb(22, 129, 227); font-size: 14px;" class="download" href="javascript: void(0)">不能播放？查看链接下载到电脑或手机本地播放</a>
        </div>
	    <!-- 获取防盗视频 -->
	    <div class="anti getVideo">
	        <div class="left"></div>
	        <div class="middle ">获取视频</div>
	        <div class="right">
	        	<img src="{weikucms::STATICS}/wapweiui/Intel/imgs/i.jpg" />
	        </div>
	    </div>
    </body>
<include file="./tpl/Wap/default/Intel_fx.html" />
<script type="text/javascript">
    $(function(){
        var getpicName = $('.getpic');
        var getVideoName = $('.getVideo');
        var url = "{weikucms::U('Wap/Intel/setcenter',array('token'=>$token,'openid'=>$openid))}";

        ajaxval(getpicName,url, function(){
            var data = {};
            data.type = 'photo';
            $('#dyGetPhoto').hide();
            $('#dyGetPhoto img').attr('src', '');
            data.picsize =  $.trim($('.picsize').attr('data-id'));
            msg.alert('正在获取，请稍候...', '', 3000000);
            return data;
        }, function(json, data){
            getResult(json, data, function(json){
                $('#msgBlur').remove();
                if(json.code == 0){
                    $('#dyGetPhoto').show();
                    $('#dyGetPhoto img').attr('src', json.data);
                }else{
                    msg.alert('获取失败,请稍候再试', '我知道了');
                    return false;
                }
            })
        });
        ajaxval(getVideoName,url, function(){
            var data = {};
            data.type = 'video';
            $('#playScreen').hide();
            data.videotime = parseInt($('.special .videotime').text());
            msg.alert('正在获取，请稍候...', '', 10000000);
            return data;
        }, function(json, data){
            getResult(json, data, function(json, data){
                $('#msgBlur').remove();
                if(json.code == 0){
                    $('#playScreen').show();
                    $('#playScreen video').attr({'src':json.data, 'autoplay':true});
                    $('#playScreen .download').attr({'url':json.file});
                }else{
                    msg.alert('获取失败,请稍候再试', '我知道了');
                    return false;
                }
            })
        });

        $(document).on('touchstart', '.download', function(){
            msg.alert('<div style="word-break: break-all; padding: 10px;">' + '{weikucms:$site_url}' + $(this).attr('url') + '</div>', '知道了');
        });

        var Timeout = false;
        var i       = 0;
        var num     = 40;
        function getResult(json, data, callback){
            if(json['code'] != 0){
                $('#msgBlur').remove();
                msg.alert('获取失败，请重试', '', 1000);
                return;
            }
            i = 0;
            Timeout = setInterval(function(){
                i++;
                ajax(
                    "{weikucms::U('Wap/Intel/getResult',array('token'=>$token,'openid'=>$openid))}",
                    data,
                    function(ret){
                        if(ret['code'] == 0){
                            clearTimeout(Timeout)
                            $('#msgBlur').remove();
                            if(typeof(callback) == 'function'){
                                callback(ret);
                            }
                        }else{
                            if(i > num){
                                clearTimeout(Timeout)
                                $('#msgBlur').remove();
                                msg.alert('获取失败，请重试', '', 1000);
                            }
                        }
                    }
                );
            }, 1500);
        }
    })
</script>
</html>
