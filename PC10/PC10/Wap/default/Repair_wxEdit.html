<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="{weikucms::STATICS}/wapweiui/service/css/default1.css" type="text/css">
<script type="text/javascript" async="" src="{weikucms::STATICS}/wapweiui/service/js/ga.js"></script>
<script src="{weikucms::STATICS}/wapweiui/service/js/jquery-1.8.2.min.js"></script>
<script src="{weikucms::STATICS}/wapweiui/service/js/common.js"></script>
<script src="{weikucms::STATICS}/wapweiui/service/js/area.js"></script>
<link href="{weikucms::STATICS}/wapweiui/service/css/index.css" rel="stylesheet" type="text/css">
<link href="{weikucms::STATICS}/wapweiui/service/css/box.css" rel="stylesheet" type="text/css">
<link href="{weikucms::STATICS}/wapweiui/service/css/usercenter.css" rel="stylesheet" type="text/css">
<link href="{weikucms::STATICS}/wapweiui/service/css/usercenter_bg.css" rel="stylesheet" type="text/css">
<meta charset="UTF-8">
<title>{weikucms:$tpl['name']}</title>
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black" name="apple-mobile-web-app-status-bar-style">
<meta content="telephone=no" name="format-detection"> 
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" name="viewport" />
<script type="text/javascript">
var img_site_url = '{weikucms::STATICS}/wapweiui/service/css/';
var js_site_url  = '{weikucms::STATICS}/wapweiui/service/js/';
var imgSiteUrl   = '{weikucms::STATICS}/wapweiui/service/images/';
var browser={
    versions:function(){
           var u = navigator.userAgent, app = navigator.appVersion;
           return {
                trident: u.indexOf('Trident') > -1,
                presto: u.indexOf('Presto') > -1,
                webKit: u.indexOf('AppleWebKit') > -1,
                gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1,
                mobile: !!u.match(/AppleWebKit.*Mobile.*/)||!!u.match(/AppleWebKit/),
                ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),
                android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1,
                iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1,
                iPad: u.indexOf('iPad') > -1,
                webApp: u.indexOf('Safari') == -1
            };
         }(),
         language:(navigator.browserLanguage || navigator.language).toLowerCase()
}
</script>
<style type="text/css">
	td a{
		color: #f00;
		display: block;
	}
</style>
<style type="text/css">
	#bottom td a{
		color: #fff;
		display: block;
		font-size: 20px;
	}
</style>
<script type="text/javascript">
    $(function(){
    	if(document.body.scrollHeight > $(window).height()){
    		$('#bottom').css({'width':$(window).width(),'left':0,'bottom':-(document.body.scrollHeight-$(window).height())});
    	}else{
    		$('#bottom').css({'width':$(window).width(),'left':0});
    	}
        
    })
</script>
</head>
<body>
<div class="pageTitle" style="font-size:15px;">
    <i style="background:#f15151;"></i>
    <span class="arrow-r" style="border-left:10px solid #f15151;"></span>
    <a href="{weikucms::U('Wap/Repair/wxCenter',array('token'=>$token,'openid'=>$openid))}" style="color:#fff;">个人中心</a>&nbsp;>>&nbsp;用户资料
</div>
<div class="publicList wml100">
    <ul>
        
        <li class="noAfter">
            <div class="li-l">姓名<span style="color:#f00">*</span></div>
            <div class="li-r"><input id="yname" placeholder="输入姓名" value="{weikucms:$repair_user.username}" class="input" type="text" ></div>
        </li>
         <li class="noAfter">
            <div class="li-l">手机号码<span style="color:#f00">*</span></div>
            <div class="li-r"><input id="phoneNo" placeholder="输入手机号码" value="{weikucms:$repair_user.user_tel}" class="input" type="tel" ></div>
        </li>
        
         <li class="noAfter">
            <div class="li-l">微信号</div>
            <div class="li-r">
            	<input id="MicroMsgNo" placeholder="输入微信号" value="{weikucms:$repair_user.weixin_no}" class="input" type="text" />
            </div>
        </li>
        <li class="noAfter">
        	<div class="li-l">选择区域<span style="color:#f00">*</span></div>
        	<div class="li-r">          		
            	<select id="addarea" class="select">
            		<option selected="selected" value="0">选择省</option>
            		<volist name="province" id="vo">
			            <option value="{weikucms:$vo.code}" id="pp_{weikucms:$vo.code}">{weikucms:$vo.name}</option>			                
			        </volist>
				</select>
				<br/>
				<select id="city" class="select" style="margin-top:3px;display:none;">
				</select>
				<br/>
				<select id="county" class="select" style="margin-top:3px;display:none;">
				</select>
				<br/>
				<select id="town" class="select" style="margin-top:3px;display:none;">
				</select>
            </div>
        </li>
        <li class="noAfter">
            <div class="li-l">区域</div>
            <div class="li-r">
                <input id="area" value="{weikucms:$repair_user.area}" class="input" type="text" readonly>
            </div>
        </li>
        <li class="noAfter">
            <div class="li-l">详细地址<span style="color:#f00">*</span></div>
            <div class="li-r">
                <input id="address" placeholder="输入详细地址" value="{weikucms:$repair_user.address}" class="input" type="text" >
            </div>
        </li>
        <if condition="$style neq 1">     
         <li class="noAfter">
            <div class="li-l">推荐人</div>
            <div class="li-r">
            	<div id="Recommended">{weikucms:$repair_user.referee}</div>
            </div>
        </li>
        <else/>
        </if>
        <if condition="$repair_user['username'] neq ''">
        <li class="noAfter">
            <div class="li-l">屏蔽服务商</div>
            <div class="li-r">
                <a href="{weikucms::U('Wap/Repair/screen',array('token'=>$token,'openid'=>$openid))}">点击设置</a>
            </div>
        </li>
        </if>
    </ul>
</div>
<input type="hidden" id="id" value="{weikucms:$agentId}"/> 
<if condition="$type eq 1">
	<div class="button clearfix">
	  	<a href="javascript:void(0);" style="background:#f00;text-align:center;color:#fff;font-weight:400;border-radius:6px;line-height:2em;font-size:16px;border:1px solid #f00;padding:0;" id="thissave"><if condition="$style neq 1">修改<else/>保存</if></a>
	</div>
<else/>
	<div class="button clearfix">
		<a href="javascript:void(0);" style="background:#f00;text-align:center;color:#fff;font-weight:400;border-radius:6px;line-height:2em;font-size:16px;padding:0;" id="thisadd" class="gray flag">添加</a>
	</div>
</if>

<div style="height:100px;">
</div>
<footer>
  <div class="fix-bottom"></div>
    <div class="bottomBox">
        <div class="indexMsg">
            <div class="indexMenu">
                    <a href="index.php?g=Wap&amp;m=Repair&amp;a=wxhome&amp;token={weikucms:$token}&amp;openid={weikucms:$openid}">
                        <span class="home-index-active">首页</span>
                    </a>
                    <a href="index.php?g=Wap&amp;m=Repair&amp;a=wxOrder&amp;token={weikucms:$token}&amp;openid={weikucms:$openid}">
                      <span class="Order-index">订单</span>
                    </a>
                    <a href="index.php?g=Wap&amp;m=Repair&amp;a=wxCenter&amp;token={weikucms:$token}&amp;openid={weikucms:$openid}">
                      <span class="My-index">个人中心</span>
                    </a>
                    
              </div>
        </div>
    </div>
</footer>
<style type="text/css">
    .gray{
    border-top:2px solid #ddd;
    border-left:2px solid #ddd;
    border-right:2px solid #888;
    border-bottom:2px solid #888;
  }
    .red{
    border-top:2px solid #888;
    border-left:2px solid #888;
    border-right:2px solid #ddd;
    border-bottom:2px solid #ddd;
  }.indexMenu a span{
        color: #fff;
  }
</style>

  <script type="text/javascript">
  $(function(){

    $('.flag').mousedown(function(){
      $(this).removeClass('gray').addClass('red');
      
    })
    $('.flag').mouseup(function(){
      $(this).addClass('gray').removeClass('red');
      
    })
    
    
    $("#addarea").change(function(){
			
			if($("#addarea").val() == 0){
				alert('请选择省');
			} else {
				
				var id = $("#addarea").val();
				
				var div = document.getElementById("city");
                while(div.hasChildNodes()) //当div下还存在子节点时 循环继续
                {
                    div.removeChild(div.firstChild);
                }
				
				var city = '<option selected="selected" value="0">选择市</option>';
                var url="index.php?g=Wap&m=Repair&a=findCity&token="+$("#token").val()+"&openid="+$("#openid").val();
               
                
                
                $.post(url,{id:id},
                function(data){ 
                  if(data.status == 100){
                  	var length = data.data.length;
                  	var i = 1;
                  	
                  	for(i; i<=length; i++){
                  		var index = i-1;
                  		city += '<option value="'+data.data[index].code+'" id="cc_'+data.data[index].code+'">'+data.data[index].name +'</option>"';
                  		  		
                  	}
                	//alert(data.data[0].id)
                  	//alert(tet);
                	$("#city").show();
                  	$("#city").append(city);
                  }
              },'json');
                
			}
			
		});
		
		$("#city").change(function(){
			
			if($("#city").val() == 0){
				alert('请选择市');
			} else {
				
				var id = $("#city").val();
				
				var div = document.getElementById("county");
                while(div.hasChildNodes()) //当div下还存在子节点时 循环继续
                {
                    div.removeChild(div.firstChild);
                }
				
				var county = '<option selected="selected" value="0">选择区/县</option>';
                var url="index.php?g=Wap&m=Repair&a=findCounty&token="+$("#token").val()+"&openid="+$("#openid").val();
			   
                $.post(url,{id:id},
                function(data){ 
                  if(data.status == 100){
                  	var length = data.data.length;
                  	var i = 1;
                  	
                  	for(i; i<=length; i++){
                  		var index = i-1;
                  		county += '<option value="'+data.data[index].code+'" id="xx_'+data.data[index].code+'">'+data.data[index].name +'</option>"';
                  		  		
                  	}
                	//alert(data.data[0].id)
                  	//alert(tet);
                	$("#county").show();
                  	$("#county").append(county);
                  }
              },'json');
			}
			
		});

		
		$("#county").change(function(){
			
			if($("#county").val() == 0){
				alert('请选择区/县');
			} else {
				
				var id = $("#county").val();
				
				var div = document.getElementById("town");
                while(div.hasChildNodes()) //当div下还存在子节点时 循环继续
                {
                    div.removeChild(div.firstChild);
                }

                var ppobj = document.getElementById("addarea");
                var pptxt = ppobj.options[ppobj.selectedIndex].text;
                
                var ccobj = document.getElementById("city");
                var cctxt = ccobj.options[ccobj.selectedIndex].text;
                
                var ttobj = document.getElementById("county");
                var tttxt = ttobj.options[ttobj.selectedIndex].text;

                var txt =  pptxt + cctxt +tttxt;
                
                $("#area").val(txt);  

				        /*
				        var county = '<option selected="selected" value="0">选择镇</option>';
                var url="index.php?g=Wap&m=Repair&a=findTown&token="+$("#token").val()+"&openid="+$("#openid").val();
			   
                $.post(url,{id:id},
                function(data){ 
                  if(data.status == 100){
                  	var length = data.data.length;
                  	var i = 1;
                  	
                  	for(i; i<=length; i++){
                  		var index = i-1;
                  		county += '<option value="'+data.data[index].code+'" id="tt_'+data.data[index].code+'">'+data.data[index].name +'</option>"';
                  		  		
                  	}
                	//alert(data.data[0].id)
                  	//alert(tet);
                	$("#town").show();
                  	$("#town").append(county);
                  }
              },'json');
              */
			}
			
		});
	
	$("#town").change(function(){
		
		if($("#town").val() == 0){
			alert('请选择镇');
		} else {
			
			var ppobj = document.getElementById("addarea");
			var pptxt = ppobj.options[ppobj.selectedIndex].text;
			
			var ccobj = document.getElementById("city");
			var cctxt = ccobj.options[ccobj.selectedIndex].text;
			
			var ttobj = document.getElementById("county");
			var tttxt = ttobj.options[ttobj.selectedIndex].text;
			
			var obj = document.getElementById("town");
			var txt = obj.options[obj.selectedIndex].text;

            txt =  pptxt + cctxt +tttxt + txt;
			
			$("#area").val(txt);
		}
		
	});   
  });
</script>
    <script type="text/javascript">
$(function(){
	$('#thissave').click(function(){
		//修改
        var yname=$('#yname').val();
        var MicroMsgNo=$('#MicroMsgNo').val();
        var phoneNo = $("#phoneNo").val();
        var s_province = $("#addarea").val();
        var s_city = $("#city").val();
        var s_county = $("#county").val();
        var town = $("#town").val();
        var address=$('#address').val();

	   if( !yname ){
                show_error_tip('名称不能为空！'); 
                return false;
       }
	   
       if( !phoneNo ){
                show_error_tip('手机号码不能为空！'); 
                return false;
            }
       
       /*if(s_province == 0){
    	   show_error_tip('请选择省份！'); 
           return false;
       }
       if(s_city == 0){
    	   show_error_tip('请选择地级市！'); 
           return false;
       }
       if(s_county == 0){
    	   show_error_tip('请选择市、县级市！'); 
           return false;
       }
	   if(town == 0){
	       show_error_tip('请选择镇！'); 
           return false;
	   }
	   */

       if( !address ){
                show_error_tip('地址不能为空！'); 
                return false;
       }
        /*
        var ppobj = document.getElementById("addarea");
        var pptxt = ppobj.options[ppobj.selectedIndex].text;

        var ccobj = document.getElementById("city");
        var cctxt = ccobj.options[ccobj.selectedIndex].text;

        var ttobj = document.getElementById("county");
        var tttxt = ttobj.options[ttobj.selectedIndex].text;

        var obj = document.getElementById("town");
        var txt = obj.options[obj.selectedIndex].text;
        */

       var area = $("#area").val();
       var url="index.php?g=Wap&m=Repair&a=wxEdit&token={weikucms:$token}&openid={weikucms:$openid}&type={weikucms:$style}";
             $.post(url,{yname:yname,MicroMsgNo:MicroMsgNo,phoneNo:phoneNo,area:area,address:address},
            function(data){ 
              if(data.status == 100){
            	  show_success_tip(data.info);
                  setTimeout(function(){                            
                      window.location.href = data.url;
                  },'1000');
              }else if(data.status == 1 ){
                show_error_tip(data.info);
                setTimeout(function(){                          
                      window.location.href = data.url;
                  },'1000');
              }else if(data.status == 2 ){
                show_error_tip(data.info);
                setTimeout(function(){                          
                      window.location.href = data.url;
                  },'1000');
              }
          },'json');
	});
	$('#thisadd').click(function(){
		//修改
		var yname=$('#yname').val();
        var MicroMsgNo=$('#MicroMsgNo').val();
		var phoneNo = $("#phoneNo").val();
		var s_province = $("#addarea").val();
		var s_city = $("#city").val();
		var s_county = $("#county").val();
		var town = $("#town").val();
		var address=$('#address').val();

	   if( !yname ){
                show_error_tip('名称不能为空！'); 
                return false;
       }
       if( !phoneNo ){
                show_error_tip('手机号码不能为空！'); 
                return false;
            }
       
       if(s_province == 0){
    	   show_error_tip('请选择省份！'); 
           return false;
       }
       if(s_city == 0){
    	   show_error_tip('请选择地级市！'); 
           return false;
       }
       if(s_county == 0){
    	   show_error_tip('请选择市、县级市！'); 
           return false;
       }
	   if(town == 0){
	       show_error_tip('请选择镇！'); 
           return false;
	   }
       
       if( !address ){
                show_error_tip('地址不能为空！'); 
                return false;
            }

        var ppobj = document.getElementById("addarea");
        var pptxt = ppobj.options[ppobj.selectedIndex].text;

        var ccobj = document.getElementById("city");
        var cctxt = ccobj.options[ccobj.selectedIndex].text;

        var ttobj = document.getElementById("county");
        var tttxt = ttobj.options[ttobj.selectedIndex].text;

        var obj = document.getElementById("town");
        var txt = obj.options[obj.selectedIndex].text;


        var area = pptxt+cctxt+tttxt+txt;

       var url="index.php?g=Wap&m=Repair&a=wxEdit&token={weikucms:$token}&openid={weikucms:$openid}&type={weikucms:$style}";
       $.post(url,{yname:yname,MicroMsgNo:MicroMsgNo,phoneNo:phoneNo,area:area,address:address},
       function(data){ 
         if(data.status == 100){ 
        	 show_success_tip(data.info);
             setTimeout(function(){                            
                 window.location.href = data.url;
             },'1000');
         }else if(data.status == 1 ){
           show_error_tip(data.info);
           setTimeout(function(){                          
                 window.location.href = data.url;
             },'1000');
         }else if(data.status == 2 ){
           show_error_tip(data.info);
           setTimeout(function(){                          
                 window.location.href = data.url;
             },'1000');
         }
     },'json');
});
})
</script>
</body>
</html>