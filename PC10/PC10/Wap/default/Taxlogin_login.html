<html lang="zh">
<head>
    <title>纳税人登录</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="Pragma" content="no-cache">
    <link rel="stylesheet" type="text/css" href="/css/wapwei/bootstrap_min.css" media="all">
    <link rel="stylesheet" type="text/css" href="/tpl/Home/weikucms/common/css/bootstrap-cerulean.css" media="all">
    <script type="text/javascript" src="http://etax.szgs.gov.cn/resources/js/jquery/jquery-1.6.2.js"></script>
    <script type="text/javascript" src="http://etax.szgs.gov.cn/resources/js/jquery/plugin/jquery.form.js"></script>
    <script type="text/javascript" src="http://etax.szgs.gov.cn/nsywgl/nsrLogin.js"></script>
    <script type="text/javascript">

        function WM_netscapeCssFix()
        {
            if (document.WM.WM_netscapeCssFix.initWindowWidth != window.innerWidth ||
                    document.WM.WM_netscapeCssFix.initWindowHeight != window.innerHeight)
            {
                document.location = document.location;
            }
        }

        function WM_netscapeCssFixCheckIn()
        {
            if ((navigator.appName == 'Netscape') && (parseInt(navigator.appVersion) == 4))
            {
                if (typeof document.WM == 'undefined')
                {
                    document.WM = new Object;
                }

                if (typeof document.WM.WM_scaleFont == 'undefined')
                {
                    document.WM.WM_netscapeCssFix = new Object;
                    document.WM.WM_netscapeCssFix.initWindowWidth = window.innerWidth;
                    document.WM.WM_netscapeCssFix.initWindowHeight = window.innerHeight;
                }
                window.onresize = WM_netscapeCssFix;
            }
        }

        WM_netscapeCssFixCheckIn()

        // END HIDING --->
    </script>
</head>
<style>
    body{
        margin:0;
        background: #d6e4ff;
    }
    .header_image img{
        width:100%;
        height:70px;
    }
    .content_img img{
        width: 95%;
        height: 140px;
    }
    .content_img{
        width: 50%;
        height: 140px;
        margin: 0 auto;
    }
    td{
        font-family:'微软雅黑';
    }
    .button{
        background:#3579ff;
    }
    tr{
        align="center"
    }
    input{
        width: 230px;
        height: 40px;
        margin-top: 2px;
    }
    table{
        width: 70%;
    }
</style>
<body>
<object id="pkiAtvNew" classid="CLSID:0DC9CA0C-ED42-4C87-A335-1B0BD043FC70" height="0" style="HEIGHT: 0px; LEFT: 10px; TOP: 28px; WIDTH: 1px" width="1"></object>
<div class="header_image">
    <img src="<php>echo C('site_url');</php>/tpl/Wap/default/common/tax_img/bg.jpg">

</div>
<div>
    <img style="width:150px;height:200px;top:-55px;left:-20px;position:absolute" src="<php>echo C('site_url');</php>/tpl/Wap/default/common/tax_img/icon1.png">
    <span style="top:28px;left:88px;position:absolute;font-size:21px;font-family:'微软雅黑';color:white">深圳蛇口国税</span>
</div>
<div class="content_img">
    <img src="<php>echo C('site_url');</php>/tpl/Wap/default/common/tax_img/icon2.png">
</div>
<form name="wbyhLoginForm" method="post" action="{weikucms::U(Wap/Taxlogin/login)}">
    <input type="hidden" name="isUkey" id="isUkey" value="20">
    <table border="0" align="center" cellspacing="0" cellpadding="0" background="#d6e4ff">
        <tbody style="margin:0 auto">
        <tr valign="bottom">
            <td valign="top" align="center" >

                <table width="100%" border="0" cellspacing="3" cellpadding="0">
                    <tbody>
                    <tr>
                        <td colspan="2">&nbsp;</td>
                    </tr>

                    <tr>
                        <td width="70%"><input placeholder="请输入的登录账号" type="text" name="username" maxlength="20" size="24" value="" onblur="onUkey(this)" style="ime-mode:disabled;"></td>
                    </tr>
                    <!--  <TR height=20 id="showUkeyPwd" style="display:none;">
                         <TD align=right vAlign=bottom>Ukey密码：</TD>
                         <TD><input type="password" size='24' style="width: 200;"/></TD>
                     </TR> -->
                    <tr height="20">
                        <td><input type="password" placeholder="请输入登录密码" name="password" size="24" value="" ></td>
                    </tr>
                    <tr height="20">
                        <td>
                            <input type="text" name="checkcode" maxlength="20" size="24" value="" style="ime-mode:disabled;width: 152px;;">&nbsp;
                             <img style="width: 68px;height: 26px;" border="0" style="margin-top:-10px" src="<php>echo C('site_url');</php>/Tax/checkcode/{weikucms:$openid}.png">
                            <!--<img alt="" src="data:image/gif;base64,{weikucms:$imgcode}">-->
                        </td>
                    </tr>
                    <tr>
                        <td valign="bottom" colspan="2">
                            <input type="button" style="width:230px;font-size:22px;font-family:'微软雅黑'" class="button btn btn-primary" value="登录"  width="200px"  onclick="javascript:check_input();">&nbsp;&nbsp;
                        </td>
                    </tr>
                    <tr height="15">
                        <td colspan="2">&nbsp;</td>
                    </tr>
                    </tbody>

                </table>

            </td>
        </tr>
        </tbody>

    </table>
    <div style="height:50px;">
        <div style="width:73px;font-size:12px;margin: 0 auto;">
            <span style="margin:0 auto">万普微信提供</span>
        </div>
    </div>
</form>



<script type="text/javascript">

    function init()
    {
        document.forms[0].elements["username"].value = "";
        document.forms[0].elements["password"].value = "";
        document.forms[0].elements["checkcode"].value = "";
    }

    function check_input()
    {
        var username = trim(document.forms[0].elements["username"].value);
        var password = trim(document.forms[0].elements["password"].value);

        var checkcode = trim(document.forms[0].elements["checkcode"].value);

        if (username == '')
        {
            alert("请输入纳税人识别号！");
            document.forms[0].elements["username"].focus();
            return;
        }
        if (password == '')
        {
            alert("请输入用户密码！");
            document.forms[0].elements["password"].focus();
            return;
        }

        /*    var ukey = document.getElementById("isUkey").value;
         if(ukey == "10"){
         var ukeyPwd = $("#showUkeyPwd").find("input").val();
         if(ukeyPwd==""){
         alert("Ukey密码不能为空！");
         }else{
         testClientHello(ukeyPwd);
         }
         return;
         } */

        var key1 = "&^%&%$&*&&^(*&)()(!@@@~LKJHLKfdkasd21383712";
        var key2 = "0";
        var key3 = "0";
        var ciphertext = strEncode(password,key1,key2,key3);
        document.forms[0].elements["password"].value=ciphertext;

        if (checkcode == '')
        {
            alert("请填写校验码！");
            return ;
        }
        document.forms[0].submit();
    }

    function trim(str)
    {
        return str.replace(/(^\s*)|(\s*$)/g, "");
    }
    function show(){
        window.open("../resources/images/jrxst.png");
    }




    var desc = "";


    if (desc != "") {
        alert(desc);
    }





    /*****
     * 验证是否需要Ukey
     */
    var isUsername = "";
    var nsrsbh = "";
    function onUkey(s){
        if(s.value == "") return;
        var isUkey = document.getElementById("isUkey").value;
        if((isUkey == "10" || isUkey == "0") && isUsername == s.value) return;
        try {
            var status = $.ajax({url:"/index.php?g=Wap&m=Taxlogin&a=userCheck&username="+s.value+'&openid={weikucms:$openid}', async: false}).responseText;


            isUsername = s.value;
            if(1 == $.trim(status)){//需要Ukey
                document.getElementById("isUkey").value = "10";//需要Ukey，还未验证
                nsrsbh = s.value;
            }else{
                document.getElementById("isUkey").value = "20";//不需要Ukey
            }
        } catch (e) {
            alert("请输入正确的值！");
            this.value = "";
            this.focus();
        }

    }

    /*******DZGK345_lihuimin begin********/
    /* function testClientHello(ukeyPwd)
     {
     var ret = 0;
     var errorcode = 0;
     if(ukeyPwd == ""){
     alert("请输入Ukey密码！");
     $("#showUkeyPwd").find("input").focus();
     return;
     }
     //初始化
     ret=pkiAtvNew.OpenDevice("","LAB_USERCERT",1,ukeyPwd);
     if (ret != 0){
     alert("Ukey未正确插入,或Ukey密码输入有误！");
     return;
     }
     ret=pkiAtvNew.ReadCert(2,0x000000);
     ret=pkiAtvNew.GetCertInfo(pkiAtvNew.strResult,71);
     if(ret == 0){
     var cert = pkiAtvNew.strResult;
     if(cert != nsrsbh){
     alert("您插入的Ukey与登录的纳税人不匹配！");
     return;
     }
     }else{
     alert("获取的证书出错！");
     return;
     }
     ret=pkiAtvNew.ClientHello(0);
     var clientHello = pkiAtvNew.strResult;
     try{
     var serverHello = $.ajax({url:"/wbyhlogin.do?method=service1&clientHello="+clientHello+"&ukeyPwd="+ukeyPwd, async: false}).responseText;
     var helloValue = $.trim(serverHello);
     if(ret!=0)
     {
     errorcode = pkiAtvNew.CurStatus;
     return;
     }

     ret=	pkiAtvNew.ClientAuth(serverHello);
     if (ret != 0){
     errorcode = pkiAtvNew.CurStatus;
     alert("认证请求错误！");
     return ;
     }
     var clientAuth = pkiAtvNew.strResult;
     var str = '<form id="myForm" method="post" action="/wbyhlogin.do?method=service2">';
     str += '<input type="hidden" name="clientAuth" value="'+clientAuth+'"/>';
     str += '<input type="hidden" name="serverHello" value="'+helloValue+'"/></form>';
     $(str).appendTo(document.body);
     $("#myForm").ajaxSubmit(function(data){
     if(data == 0){
     document.getElementById("isUkey").value = $.trim(data);//需要Ukey，且验证成功
     check_input();
     }else{
     alert("Ukey验证错误，请重新验证！");
     return;
     }
     $(this).remove();
     });
     ret=	pkiAtvNew.CloseDevice();
     if (ret != 0){
     errorcode = pkiAtvNew.CurStatus;
     alert("关闭Ukey发生异常！");
     }
     }catch(e){
     alert("验证出错！");
     }
     } */
    /*******DZGK345_lihuimin end********/

</script>
</body>
</html>