window.Utils=window.Utils||{},$.extend(window.Utils,{getWxInfo:function(){var t=window.navigator.userAgent,i=t.match(/MicroMessenger\/(\d+(\.\d+)*)/),o=null!==i&&i.length,e=o?parseFloat(i[1]):0;return{isWx:o,wxVersion:e}}}),define("wap/components/util/wx_info",function(){}),define("text!wap/showcase/goods/templates/tradeRewardInfo.html",[],function(){return'<hr class="with-margin">\n<div class="trade-reward-content">\n    <span class="trade-reward-tag font-size-12">满减</span>\n    <span class="js-trade-reward-info font-size-12 trade-reward-info hide-part-text">\n        <%-data.str %>\n    </span>\n    <% if(data.hideText){ %>\n        <span class="js-arrow-down arrow"></span>\n    <% } %>\n</div>'}),define("text!wap/showcase/goods/templates/goodsCount.html",[],function(){return'<% if ( data.day > 0 ) { %>\n<i class="mc-num-days"><%- (+data.day) %></i><span class="mc-text">天</span>\n<% } %>\n<% if ( data.day > 0 || data.hour > 0 ) { %>\n<i class="mc-num-hours"><%- (+data.hour) %></i><span class="mc-text">小时</span>\n<% } %>\n<i class="mc-num-minutes"><%- data.min %></i><span class="mc-text">分</span>\n<i class="mc-num-seconds"><%- data.sec %></i><span class="mc-text">秒</span>'}),define("wap/components/count_down",[],function(){function t(t,i,o,e,n){var s=0,a=0,d=0,r=0,h=0,c="",l=new Date,u=t.getTime()-l.getTime();return 0>=u?(n.stop(),i({seconds:0,text:"00:00:000",hour:0,min:0,sec:0,msec:0,day:0}),void o()):(u>864e5&&(s=Math.floor(u/864e5),u-=864e5*s,c+=s+"天"),u>36e5&&(a=u>36e6?Math.floor(u/36e5):"0"+Math.floor(u/36e5),u-=36e5*a,c+=a+"小时"),u>6e4?(d=Math.floor(u/6e4)%60,r=Math.floor(u/1e3)%60,h=u%1e3):(d=0,r=Math.floor(u/1e3),h=u%1e3),10>d&&(c+="0"),c+=d+"分",10>r&&(c+="0"),c+=r+"秒",10>h?c+="00":100>h&&(c+="0"),"second"!=e&&(c+=h),void i({text:c,hour:a,min:d,sec:r,msec:h,day:s}))}function i(){this.tid=null,this.startTime=null}var o=function(){};return i.prototype={run:function(i){function e(){r.tid=setTimeout(e,"second"==i.step?1e3:50),t(d,s,a,i.step,r)}this.startTime||(this.startTime=Date.now());var n=i.seconds||0,s=i.onTimeChange||o,a=i.onTimeChangeEnd||o;this.startTime+=1e3*n;var d=new Date(this.startTime),r=this;e()},stop:function(){clearTimeout(this.tid)}},i}),define("wap/showcase/goods/goods",["wap/components/util/wx_info","text!wap/showcase/goods/templates/tradeRewardInfo.html","text!wap/showcase/goods/templates/goodsCount.html","wap/components/count_down"],function(t,i,o,e){var n=_.template(i),s=_.template(o),a=Backbone.View.extend({el:"body",qrTemplate:_.template($("#tmpl-side-qrcode").html()),events:{"click .js-qrcode-buy":"qrcodeBuyTip","click .js-hide-qrcode":"hideQrcode","click .js-add-cart":"onAddCartClicked","click .js-buy-it":"onBuyItClicked","click .js-add-gift":"onGiftClicked","click .js-trade-reward":"onRewardArrowClicked"},initialize:function(t){this.buyConfig=t.buyConfig;var i=this.sku=window._global.sku;this.skuTree=i.tree,this.skuMap=i.map,this.skuList=i.list,this.messages=i.messages;var o=this.keys=_.pluck(this.skuTree,"k");this.keysMsg=o.join(" 和 "),this.values=_.pluck(this.skuTree,"v"),this.len=this.skuTree.length,this.goodsId=window._global.goods_id,this.quota=window._global.quota||1/0,this.buyQuantity=1,this.totalStock=i.stock_num,this.price=i.price,this.postage=window._global.postage||0,this.qrCache={},this.activityAlias=window._global.activity_alias,this.fullPage=this.$(".wap-page-goods"),this.imageSwiper=this.$(".js-image-swiper"),this.taoInfo=this.$(".custom-go-tao"),this.returnBtn=this.$(".js-butn-return"),this.buyBtn=this.$(".js-buy-it"),this.confirmBtn=this.$(".js-confirm-it"),this.componentsContainer=this.$(".js-components-container"),this.bottomOpts=this.$(".js-bottom-opts"),this.qrcodeContainer=$(".js-qrcode-container"),this.qrcodeBtn=this.$(".js-qrcode-buy"),this.hideBtn=this.$(".js-hide-qrcode"),this.buyGuide=this.$(".js-buy-guide")},initCountdown:function(){var t=this,i=$(".js-mini-counter");if(i.length){var o=new e;o.run({seconds:i.data("countdown"),onTimeChange:function(t){i.html(s({data:t||{}}))},step:"second",onTimeChangeEnd:function(){t.$(".js-info-wrapper").hide(),t.$(".js-to-start").addClass("hide"),t.$(".js-normal-btns").removeClass("hide")}})}},buyAction:function(t){if(this.buyConfig){var i=Utils.getWxInfo()||{};return this.buyConfig.team_certificate?this.buyConfig.isAdmin&&!this.buyConfig.isMobile?(motify.log("预览不支持进行购买，<br />实际效果请在手机上进行。",0),!1):this.buyConfig.no_fans_buy?(setTimeout(function(){window.showGuide&&window.showGuide("follow",{goods:!0})},400),!1):this.buyConfig.permissions.aliPay||this.buyConfig.permissions.wxPay&&i.isWx?void app.trigger(t):(motify.log("该商品无法购买，请联系商家。",3e4),this.buyBtn.prop("disabled",!0),!1):(motify.log("该网店正在审核，<br />请耐心等待。",0),!1)}},onRewardArrowClicked:function(){var t=this.$(".js-arrow-down");t.hasClass("arrow-down")?(t.removeClass("arrow-down"),this.$(".js-trade-reward-info").addClass("hide-part-text")):(t.addClass("arrow-down"),this.$(".js-trade-reward-info").removeClass("hide-part-text"))},onBuyItClicked:function(t){return t.preventDefault(),t.stopPropagation(),$(t.target).prop("disabled")?!1:void this.buyAction("buy")},onAddCartClicked:function(t){return t.preventDefault(),t.stopPropagation(),$(t.target).prop("disabled")?!1:void this.buyAction("addcart")},onGiftClicked:function(t){t.preventDefault(),t.stopPropagation(),this.buyAction("gift")},qrcodeBuyTip:function(t){var i=this;t.preventDefault(),i.qrcodeContainer.hasClass("shake")||(i.qrcodeContainer.addClass("active animated shake"),setTimeout(function(){i.qrcodeContainer.removeClass("animated shake")},1200))},initPcBuy:function(){!$.kdt||$.kdt.isMobile()||$.kdt.isIPad()||(this.adminPreview(),this.initQrcodeBuy())},adminPreview:function(){var t=this;$(document.documentElement).on("switch_style",function(i,o){t.switchStyle(o)})},initQrcodeBuy:function(){var t=this,i=t.selectedSku?t.selectedSku.id:0,o=t.qrCache[i];o?t.showQrcode(o):t.geneQrcode(t.goodsId,i)},switchStyle:function(t){var i=this;switch(i.resetAdvOpts(),t){case"iphone":case"samsung-note":break;case"pc":motify.clear(),i.initPcBuy()}},scrollToTitle:function(){var t=$(".custom-go-tao").offset().top;setTimeout(function(){window.scrollTo(0,t)},10)},geneQrcode:function(t,i){var o=this,e={kdt_id:window._global.kdt_id,goods_id:t,alias:window._global.alias,type:"goods"},n=window._global.url.wap;$.ajax({url:n+"/common/url/goods.jsonp",type:"GET",dataType:"jsonp",cache:!1,data:e,beforeSend:function(){o.ajaxing=!0},success:function(t){var e=t.code;0===e?(o.showQrcode(t.data),o.cacheQrcode({sku_id:i,data:t.data})):motify.log(t.msg)},error:function(){motify.log("二维码生成失败，请重试～～")},complete:function(){o.ajaxing=!1}})},cacheQrcode:function(t){var i=this;i.qrCache[t.sku_id]=t.data},showQrcode:function(t){var i=this;i.qrcodeContainer.html(i.qrTemplate(t))},hideQrcode:function(){var t=this;t.buyGuide.hide(),t.modelsContainer.show(),t.qrcodeBtn.show(),t.hideBtn.hide()},render:function(){var t=this.$(".js-trade-reward"),i=t.width(),o=window._global.meetReduce,e=!1;return o&&(i<75+11*o.length&&(e=!0),this.$(".js-trade-reward").html(n({data:{hideText:e,str:o}}))),this.initCountdown(),this.initPcBuy(),this}});return a}),window.Utils=window.Utils||{},$.extend(window.Utils,{makeRandomString:function(t){var i="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";t=t||10;for(var e=0;t>e;e++)i+=o.charAt(Math.floor(Math.random()*o.length));return i}}),define("wap/components/util/number",function(){}),define("wap/components/pop",["wap/components/util/number"],function(){var t=function(){},i=Backbone.View.extend({initialize:function(i){var o=window.Utils.makeRandomString();$("body").append('<div id="'+o+'" class="'+i.className+'" style="overflow:hidden;visibility: hidden;"></div>'),this.nPopContainer=$("#"+o);var e=window.Utils.makeRandomString();$("body").append('<div id="'+e+'"                 style="display:none; width: 100%; height: 100%;                 position: absolute; top:0; left:0;                 background-color: rgba(0, 0, 0, '+(i.transparent||".9")+');z-index:1000;opacity:0;transition: opacity ease 0.2s;"></div>'),this.nBg=$("#"+e),this.nBg.on("click",_(this.hide).bind(this)),i.contentViewClass&&(this.contentViewClass=i.contentViewClass,this.contentViewOptions=_.extend({el:this.nPopContainer},i.contentViewOptions||{}),this.contentView=new this.contentViewClass(_.extend({onHide:_(this.hide).bind(this)},this.contentViewOptions))),this.animationTime=i.animationTime||1e3,this.isCanNotHide=i.isCanNotHide,this.onShow=i.onShow||t,this.onHide=i.onHide||t,this.html=i.html},render:function(t){return this.renderOptions=t||{},this.contentViewClass?this.contentView.render(this.renderOptions):this.html&&this.nPopContainer.html(this.html),this},show:function(){var t=$(window);return this.top=t.scrollTop(),$("html").css("position","relative"),this.nBg.show().css({opacity:"1","transition-property":"none"}),setTimeout(_(function(){t.scrollTop(0),$("body,html").css({overflow:"hidden",height:t.height()}),this.nPopContainer.css("visibility","visible"),this.doShow&&this.doShow(),this.onShow()}).bind(this),200),this},hide:function(){var t=$(window);this.isCanNotHide||(this.doHide&&this.doHide(),setTimeout(_(function(){$("html,body").css({overflow:"visible",height:"auto"});var i=this.top;if(t.scrollTop(i),i!==t.scrollTop()){var o=function(){t.scrollTop(i),i!==t.scrollTop()&&setTimeout(o)};setTimeout(o)}this.nBg.css({opacity:0,"transition-property":"opacity"}),setTimeout(_(function(){this.destroy(),$("html").css("position","static")}).bind(this),200)}).bind(this),this.animationTime),this.onHide())},destroy:function(){this.nPopContainer.remove(),this.nBg.remove(),this.contentView&&this.contentView.remove(),this.remove()}});return i}),define("wap/components/popup",["wap/components/pop"],function(t){var i=t.extend({initialize:function(i){this.onClickBg=i.onClickBg||function(){},this.onBeforePopupShow=i.onBeforePopupShow||function(){},this.onAfterPopupHide=i.onAfterPopupHide||function(){},t.prototype.initialize.apply(this,[i]),this.nPopContainer.css("opacity","0")},events:{},doShow:function(){this.contentView&&this.contentView.height?this.height=this.contentView.height():this.contentView||(this.height=this.nPopContainer.height()),this.onBeforePopupShow(),this.nPopContainer.css({height:this.height+"px",transform:"translate3d(0,100%,0)","-webkit-transform":"translate3d(0,100%,0)",opacity:.5,position:"absolute","z-index":1100}),this.bodyPadding=$("body").css("padding"),$("body").css("padding","0px"),setTimeout(_(function(){this.nPopContainer.css({transform:"translate3d(0,0,0)","-webkit-transform":"translate3d(0,0,0)","-webkit-transition":"all ease "+this.animationTime+"ms",transition:"all ease "+this.animationTime+"ms",opacity:1})}).bind(this)),setTimeout(_(function(){this.contentView&&this.contentView.onAfterPopupShow&&this.contentView.onAfterPopupShow()}).bind(this),this.animationTime)},doHide:function(){this.nPopContainer.css({transform:"translate3d(0,100%,0)","-webkit-transform":"translate3d(0,100%,0)",opacity:.5}),setTimeout(_(function(){$("body").css("padding",this.bodyPadding),this.onAfterPopupHide()}).bind(this),this.animationTime)}});return i}),require(["wap/showcase/goods/goods","wap/components/popup"],function(t,i){var o=Backbone.View.extend({initialize:function(){this.listenTo(this,"buy",this.buy),this.listenTo(this,"addcart",this.addCart),this.listenTo(this,"goods",this.goods),this.listenTo(this,"gift",this.gift),this.buyConfig={permissions:{wxPay:_global.wxpay_env,aliPay:_global.alipay_env},isAdmin:_global.is_owner_team,isMobile:_global.is_mobile,team_certificate:_global.team_certificate,no_fans_buy:_global.no_fans_buy},this.goods(),"true"!=Utils.getParameterByName("showsku")||window._global.is_owner_team&&!window._global.is_mobile||this.buy(),"true"==Utils.getParameterByName("hide_buy_btn")&&$(".js-bottom-opts").hide()},gift:function(){this.displaySku({isAddCart:!1,isGift:!0})},goods:function(){window._global;this.goodsView||(this.goodsView=new t({el:$("body"),buyConfig:this.buyConfig}).render()),this.popupView&&this.popupView.hide()},buy:function(){this.displaySku({isAddCart:!1,multiBtn:!1})},addCart:function(t){this.displaySku({isAddCart:!0,multiBtn:!1})},displaySku:function(t){var o=window._global;this.popupView=new i({contentViewClass:BuyView,className:"sku-layout sku-box-shadow",contentViewOptions:{config:{isAdmin:o.is_owner_team,isMobile:o.is_mobile},skuViewConfig:{bottom:0,left:0,right:0,top:40},isMultiBtn:!1,logURL:o.logURL,baseUrl:o.url.wap,need_ajax_login:o.need_ajax_login,wxpay_env:o.wxpay_env,isCartBtnHide:o.hide_shopping_cart},animationTime:300}).render({sku:o.sku,isAddCart:t.isAddCart,goods_id:o.goods_id,postage:o.postage,activity_alias:o.activity_alias,activity_id:o.activity_id,activity_type:o.activity_type,quota:o.quota,quota_used:o.quota_used,difTitle:!1,title:"",picture:[],price:"",origin:"",acitvity:{},isGift:t.isGift}).show(),window.scrollTo(0,0)}});window.app=new o}),define("main",function(){});